/**
 * @preserve FamilySearch JavaScript SDK
 * (c) 2013 Dallan Quass and other contributors
 * Released under the MIT license
 * http://github.com/rootsdev/familysearch-javascript-sdk
 */

!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FamilySearch=t()}(this,function(){function e(e,t,r){n[e]={deps:3===arguments.length?t:[],fn:3===arguments.length?r:t}}function t(e){var o=n[e],s=[],i=o.fn;if("function"==typeof i){for(var c=0,u=o.deps.length;u>c;c++){var a=o.deps[c],p=r[a];void 0===p&&(p=t(a),r[a]=p),s.push(p)}i=o.fn.apply(this,s)}return i}var n={},r={};return e("globals",{appKey:null,environment:null,httpWrapper:null,deferredWrapper:null,authCallbackUri:null,autoSignin:!1,accessToken:null,saveAccessToken:!1,logging:!1,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:5,server:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://sandbox.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",production:"https://ident.familysearch.org/cis-web/oauth2/v3"}}),e("helpers",["globals"],function(e){function t(e,t){return t.match(/^https?:\/\//)?t:e+("/"!==t.charAt(0)?"/":"")+t}var n={};return n.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"==Object.prototype.toString.call(e)},n.isNumber=function(e){return"[object Number]"==Object.prototype.toString.call(e)},n.isString=function(e){return"[object String]"==Object.prototype.toString.call(e)},n.isFunction=function(e){return"function"!=typeof/./?"function"==typeof e:"[object Function]"==Object.prototype.toString.call(e)},n.isObject=function(e){return e===Object(e)},n.isUndefined=function(e){return void 0===e},n.forEach=function(e,t,n){if(null!=e)if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;o>r;r++)if(t.call(n,e[r],r,e)==={})return}else for(var s in e)if(e.hasOwnProperty(s)&&t.call(n,e[s],s,e)==={})return},n.filter=function(e,t){var r=[];return n.forEach(e,function(e){t(e)&&r.push(e)}),r},n.map=function(e,t,r){var o=[];return n.forEach(e,function(e,n,s){o.push(t.call(r,e,n,s))}),o},n.uniq=function(e){for(var t={},n=[],r=0,o=e.length;o>r;r++){var s=e[r];t.hasOwnProperty(s)||(n.push(s),t[s]=1)}return n},n.find=function(e,t){var r,o=n.isFunction(t);if(e)for(var s=0,i=e.length;i>s;s++){var c,u=e[s];if(o)c=t.call(null,u);else{c=!0;for(var a in t)if(t.hasOwnProperty(a)&&u[a]!==t[a]){c=!1;break}}if(c){r=u;break}}return r},n.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},n.flatten=function(e){var t=[];return n.forEach(e,function(e){n.isArray(e)&&Array.prototype.push.apply(t,e)}),t},n.flatMap=n.compose(n.flatten,n.map),n.findOrEmpty=function(e,t){var r=n.find(e,t);return n.isUndefined(r)&&(r={}),r},n.first=function(e){var t;return e&&e.length>0&&(t=e[0]),t},n.firstOrEmpty=function(e){var t=n.first(e);return n.isUndefined(t)&&(t={}),t},n.findOrFirstOrEmpty=function(e,t){var r=n.find(e,t);return n.isUndefined(r)&&(r=n.first(e),console.log("findOrFirstOrEmpty",e)),n.isUndefined(r)&&(r={}),r},n.extend=function(e){return e=e||{},n.forEach(Array.prototype.slice.call(arguments,1),function(t){t&&n.forEach(t,function(t,n){e[n]=t})}),e},n.partialRight=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,Array.prototype.slice.call(arguments,0).concat(t))}},n.maybe=function(e){return null!=e?e:{}},n.objectExtender=function(e,t){return t?function(r){return r&&n.forEach(t(r),function(t){n.extend(t,e)}),r}:n.partialRight(n.extend,e)},n.wrapFunctions=function(e,t,r){return n.forEach(r,function(n){e[n]=function(){return t[n].apply(t,arguments)}}),e},n.extendHttpPromise=function(e,t){return n.wrapFunctions(e,t,["getResponseHeader","getAllResponseHeaders","getStatusCode"])},n.removeEmptyProperties=function(e){return n.forEach(e,function(t,n){(null==t||""===t)&&delete e[n]}),e},n.getOAuthServerUrl=function(n){return t(e.oauthServer[e.environment],n)},n.getServerUrl=function(n){return t(e.server[e.environment],n)},n.encodeQueryString=function(e){var t=[];return n.forEach(e,function(e,n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}),t.join("&")},n.appendQueryParameters=function(e,t){var r=n.encodeQueryString(t);return 0===r.length?e:e+(e.indexOf("?")>=0?"&":"?")+r},n.decodeQueryString=function(e){var t={},r=e.substring(e.indexOf("?")+1).split("&");return n.forEach(r,function(e){var n=e.split("=",2);n&&n[0]&&(t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]))}),t},n.nextTick=function(e){setTimeout(function(){e()},0)},n.refPromise=function(t){return t&&n.isFunction(t.then)?t:{then:function(r){var o=e.deferredWrapper();return n.nextTick(function(){o.resolve(r(t))}),o.promise}}},n.promiseAll=function(t){var r=e.deferredWrapper(),o=0,s=n.isArray(t)?[]:{};return n.forEach(t,function(e,t){o++,n.refPromise(e).then(function(e){s.hasOwnProperty(t)||(s[t]=e,--o||r.resolve(s))},function(){s.hasOwnProperty(t)||r.reject.apply(r,arguments)})}),0===o&&r.resolve(s),r.promise},n.createCookie=function(e,t,n){var r="";if(n){var o=new Date;o.setTime(o.getTime()+86400*n),r="; expires="+o.toUTCString()}document.cookie=e+"="+t+r+"; path=/"},n.readCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},n.eraseCookie=function(e){n.createCookie(e,"",-1)},n.eraseAccessToken=function(){e.accessToken=null,e.saveAccessToken&&n.eraseCookie(e.accessTokenCookie)},n}),e("jquery-wrappers",["globals","helpers"],function(e,t){var n={};return n.httpWrapper=function(n){return function(r,o,s,i,c){c=t.extend({url:o,type:r,dataType:"json",data:i},c),c.headers=t.extend({},s,c.headers);var u=n(c),a=e.deferredWrapper(),p=a.promise,f=null;return u.then(function(e,t,n){f=n.status,a.resolve(e)},function(e,t,n){f=e.status,a.reject(e,t,n)}),t.wrapFunctions(p,u,["getResponseHeader","getAllResponseHeaders"]),p.getStatusCode=function(){return f},p}},n.deferredWrapper=function(e){return function(){var t=e();return{promise:t.promise(),resolve:t.resolve,reject:t.reject}}},n}),e("init",["globals","jquery-wrappers","helpers"],function(e,t,n){var r={};return r.init=function(r){if(r=r||{},!r.app_key)throw"app_key must be set";if(e.appKey=r.app_key,!r.environment)throw"environment must be set";if(e.environment=r.environment,!r.http_function)throw"http must be set; e.g., jQuery.ajax";if(e.httpWrapper=t.httpWrapper(r.http_function),!r.deferred_function)throw"deferred_function must be set; e.g., jQuery.Deferred";e.deferredWrapper=t.deferredWrapper(r.deferred_function),r.auth_callback&&(e.authCallbackUri=r.auth_callback),r.auto_signin&&(e.autoSignin=r.auto_signin),r.save_access_token&&(e.saveAccessToken=!0,e.accessToken=n.readCookie(e.accessTokenCookie)),r.access_token&&(e.accessToken=r.access_token),e.logging=r.logging},r}),e("plumbing",["globals","helpers"],function(e,t){var n=0,r={};return r.getTotalProcessingTime=function(){return n},r.setTotalProcessingTime=function(e){n=e},r.get=function(e,n,o,s,i){return r.http("GET",t.appendQueryParameters(e,n),t.extend({Accept:"application/x-gedcomx-v1+json"},o),{},s,i)},r.post=function(e,n,o,s,i){return r.http("POST",e,t.extend({"Content-type":"application/x-www-form-urlencoded"},o),n,s,i)},r.put=function(e,n,o,s,i){return r.http("PUT",e,t.extend({"Content-type":"application/x-www-form-urlencoded"},o),n,s,i)},r.del=function(e,t,n,o){return r.http("DELETE",e,t,{},n,o)},r.http=function(o,s,i,c,u,a,p){var f=t.getServerUrl(s);e.accessToken&&(f=t.appendQueryParameters(f,{access_token:e.accessToken})),null==p&&(p=e.maxHttpRequestRetries);var d=e.httpWrapper(o,f,i||{},c||{},u||{}),g=e.deferredWrapper(),h=t.extendHttpPromise(g.promise,d);return d.then(function(e){var t=d.getResponseHeader("X-PROCESSING-TIME");t&&(n+=parseInt(t,10)),a&&(e=a(e,d)),g.resolve(e)},function(){var n=d.getStatusCode();if(console.log("http failure",n,p,d.getAllResponseHeaders()),401===n&&t.eraseAccessToken(),p>0&&(429===n||401===n&&e.autoSignin)){var f=0;if(429===n){var l=d.getResponseHeader("Retry-After");console.log("retryAfter",l,d.getAllResponseHeaders()),f=l?parseInt(l,10):e.defaultThrottleRetryAfter}e.getAccessToken().then(function(){setTimeout(function(){d=r.http(o,s,i,c,u,a,p-1),t.extendHttpPromise(h,d),d.then(function(e){g.resolve(e)},function(){g.reject.apply(g,arguments)})},f)})}else g.reject.apply(g,arguments)}),h},r}),e("authentication",["globals","helpers","plumbing"],function(e,t,n){function r(e,n){var r=t.isUndefined(window.screenX)?window.screenLeft:window.screenX,o=t.isUndefined(window.screenY)?window.screenTop:window.screenY,s=t.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,i=t.isUndefined(window.outerHeight)?document.documentElement.clientHeight-22:window.outerHeight,c=n.width||780,u=n.height||500,a=parseInt(r+(s-c)/2,10),p=parseInt(o+(i-u)/2.5,10),f="width="+c+",height="+u+",left="+a+",top="+p;return window.open(t.appendQueryParameters(e,n),"",f)}function o(n){var r=e.deferredWrapper();if(n)var o=setInterval(function(){try{if(n.location.hostname===window.location.hostname){var e=t.decodeQueryString(n.location.href);clearInterval(o),n.close(),e.code?r.resolve(e.code):r.reject(e.error)}}catch(s){}},e.authCodePollDelay);else r.reject("Popup blocked");return r.promise}var s={};return s.getAuthCode=function(){var n=r(t.getOAuthServerUrl("authorization"),{response_type:"code",client_id:e.appKey,redirect_uri:e.authCallbackUri});return o(n)},e.getAccessToken=s.getAccessToken=function(r){var o=e.deferredWrapper();if(e.accessToken)t.nextTick(function(){o.resolve(e.accessToken)});else{var i;i=r?t.refPromise(r):s.getAuthCode(),i.then(function(r){var s=n.post(t.getOAuthServerUrl("token"),{grant_type:"authorization_code",code:r,client_id:e.appKey});s.then(function(n){e.accessToken=n.access_token,e.accessToken?(o.resolve(e.accessToken),e.saveAccessToken&&t.createCookie(e.accessTokenCookie,e.accessToken,0)):o.reject(n.error)},function(){o.reject.apply(o,arguments)})},function(){o.reject.apply(o,arguments)})}return o.promise},s.hasAccessToken=function(){return!!e.accessToken},s.invalidateAccessToken=function(){return t.eraseAccessToken(),n.del(t.getOAuthServerUrl("token"))},s}),e("changeHistory",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonChangeHistory=function(n,r,s){return t.get("/platform/tree/persons/"+encodeURI(n)+"/changes",r,{Accept:"application/x-gedcomx-atom+json"},s,e.compose(e.objectExtender({getChanges:function(){return this.entries||[]}}),e.objectExtender(o,function(e){return e.entries})))};var o={getId:function(){return this.id},getContributorNames:function(){return e.map(this.contributors,function(e){return e.name})},getTitle:function(){return this.title},getUpdatedTimestamp:function(){return this.updated},getChangeReason:function(){return n(n(this.changeInfo)[0]).reason}};return r}),e("discussions",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonDiscussionReferences=function(r,o,s){return t.get("/platform/tree/persons/"+encodeURI(r)+"/discussion-references",o,{Accept:"application/x-fs-v1+json"},s,e.objectExtender({getDiscussionIds:function(){return e.map(n(n(this.persons)[0])["discussion-references"],function(e){return e.replace(/^.*\//,"").replace(/\?.*$/,"")})}}))},r.getDiscussion=function(n,r,s){return t.get("/platform/discussions/discussions/"+encodeURI(n),r,{Accept:"application/x-fs-v1+json"},s,e.objectExtender(o))};var o={getId:function(){return n(n(this.discussions)[0]).id},getTitle:function(){return n(n(this.discussions)[0]).title},getDetails:function(){return n(n(this.discussions)[0]).details},getNumberOfComments:function(){return n(n(this.discussions)[0]).numberOfComments}};return r.getComments=function(r,o,s){return t.get("/platform/discussions/discussions/"+encodeURI(r)+"/comments",o,{Accept:"application/x-fs-v1+json"},s,e.objectExtender({getComments:function(){return n(n(this.discussions)[0]).comments||[]}}))},r}),e("memories",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonMemoryReferences=function(r,s,i){return t.get("/platform/tree/persons/"+encodeURI(r)+"/memory-references",s,{},i,e.compose(e.objectExtender({getMemories:function(){return n(n(this.persons)[0]).evidence||[]}}),e.objectExtender(o,function(e){return n(n(e.persons)[0]).evidence})))};var o={getMemoryId:function(){return this.resource?this.resource.replace(/^.*\/memories\/(\d+)\/.*$/,"$1"):this.resource},getPersonaId:function(){return this.resourceId}};r.getPersonMemories=function(n,r,o){return t.get("/platform/tree/persons/"+encodeURI(n)+"/memories",r,{},o,e.compose(e.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),e.objectExtender(s,function(e){return e.sourceDescriptions})))};var s={getId:function(){return this.id},getArtifactURL:function(){return this.about},getTitle:function(){return n(n(this.titles)[0]).value},getTitles:function(){return e.map(this.titles,function(e){return e.value})},getDescription:function(){return n(n(this.description)[0]).value},getDescriptions:function(){return e.map(this.description,function(e){return e.value})},getArtifactFilenames:function(){return e.map(this.artifactMetadata,function(e){return e.filename})}};r.getUserMemories=function(n,r,o){return t.get("/platform/memories/users/"+encodeURI(n)+"/memories",r,{},o,e.compose(e.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),e.objectExtender(s,function(e){return e.sourceDescriptions})))},r.getMemory=function(n,r,o){return t.get("/platform/memories/memories/"+encodeURI(n),r,{},o,e.objectExtender(i))};var i={getId:function(){return n(n(this.sourceDescriptions)[0]).id},getMediaType:function(){return n(n(this.sourceDescriptions)[0]).mediaType},getArtifactURL:function(){return n(n(this.sourceDescriptions)[0]).about},getIconURL:function(){return n(n(n(n(this.sourceDescriptions)[0]).links)["image-icon"]).href},getThumbnailURL:function(){return n(n(n(n(this.sourceDescriptions)[0]).links)["image-thumbnail"]).href},getTitle:function(){return n(n(n(n(this.sourceDescriptions)[0]).titles)[0]).value},getTitles:function(){return e.map(n(n(this.sourceDescriptions)[0]).titles,function(e){return e.value})},getDescription:function(){return n(n(n(n(this.sourceDescriptions)[0]).description)[0]).value},getDescriptions:function(){return e.map(n(n(this.sourceDescriptions)[0]).description,function(e){return e.value})}};return r.getMemoryComments=function(r,o,s){return t.get("/platform/memories/memories/"+encodeURI(r)+"/comments",o,{Accept:"application/x-fs-v1+json"},s,e.objectExtender({getComments:function(){return n(n(this.discussions)[0]).comments||[]}}))},r.getMemoryPersonas=function(n,r,o){return t.get("/platform/memories/memories/"+encodeURI(n)+"/personas",r,{},o,e.objectExtender({getPersonas:function(){return this.persons||[]}}))},r.getPersonPortraitURL=function(t){return e.getServerUrl("/platform/tree/persons/"+encodeURI(t)+"/portrait")},r}),e("notes",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonNotes=function(r,o,s){return t.get("/platform/tree/persons/"+encodeURI(r)+"/notes",o,{},s,e.objectExtender({getNotes:function(){return n(n(this.persons)[0]).notes||[]}}))},r.getPersonNote=function(n,r,s,i){return t.get("/platform/tree/persons/"+encodeURI(n)+"/notes/"+encodeURI(r),s,{},i,e.objectExtender(o))};var o={getPersonId:function(){return n(n(this.persons)[0]).id},getNoteId:function(){return n(n(n(n(this.persons)[0]).notes)[0]).id},getSubject:function(){return n(n(n(n(this.persons)[0]).notes)[0]).subject},getText:function(){return n(n(n(n(this.persons)[0]).notes)[0]).text}};return r}),e("person",["helpers","plumbing"],function(e,t){function n(e,t){return e.father&&e.father.resourceId===t||e.mother&&e.mother.resourceId===t}var r={};r.getPerson=function(n,o,s){return t.get("/platform/tree/persons/"+encodeURI(n),o,{},s,e.compose(e.objectExtender({getPerson:function(){return this.persons[0]}}),r.personExtender))},r.personExtensionPointGetter=function(e){return e.persons},r.personConvenienceFunctions={getId:function(){return this.id},getBirthDate:function(){return this.display.birthDate},getBirthPlace:function(){return this.display.birthPlace},getDeathDate:function(){return this.display.deathDate},getDeathPlace:function(){return this.display.deathPlace},getGender:function(){return this.display.gender},getLifeSpan:function(){return this.display.lifespan},getName:function(){return this.display.name},isLiving:function(){return this.living},getGivenName:function(){return e.findOrEmpty(e.firstOrEmpty(e.findOrFirstOrEmpty(this.names,{preferred:!0}).nameForms).parts,{type:"http://gedcomx.org/Given"}).value},getSurname:function(){return e.findOrEmpty(e.firstOrEmpty(e.findOrFirstOrEmpty(this.names,{preferred:!0}).nameForms).parts,{type:"http://gedcomx.org/Surname"}).value},getDisplayAttrs:function(){return this.display}},r.personExtender=e.objectExtender(r.personConvenienceFunctions,r.personExtensionPointGetter),r.getMultiPerson=function(t,n,o){var s={};return e.forEach(t,function(e){s[e]=r.getPerson(e,n,o)}),e.promiseAll(s)},r.getPersonWithRelationships=function(n,s,i){return t.get("/platform/tree/persons-with-relationships",e.removeEmptyProperties(e.extend({person:n},s)),{},i,e.compose(e.objectExtender(o),r.personExtender))};var o={getPerson:function(t){return e.findOrEmpty(this.persons,{id:t})},getPrimaryId:function(){return e.findOrEmpty(this.persons,function(e){return"1"===e.display.ascendancyNumber}).id},getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getFatherIds:function(){var t=this.getPrimaryId();return e.uniq(e.map(e.filter(this.childAndParentsRelationships,function(e){return e.child.resourceId===t&&e.father}),function(e){return e.father.resourceId}))},getFathers:function(){return e.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){var t=this.getPrimaryId();return e.uniq(e.map(e.filter(this.childAndParentsRelationships,function(e){return e.child.resourceId===t&&e.mother}),function(e){return e.mother.resourceId}))},getMothers:function(){return e.map(this.getMotherIds(),this.getPerson,this)},getParentsIds:function(){var t=this.getPrimaryId();return e.map(e.filter(this.childAndParentsRelationships,function(e){return e.child.resourceId===t&&(e.father||e.mother)}),function(e){return[e.father?e.father.resourceId:"",e.mother?e.mother.resourceId:""]})},getParents:function(){return e.map(this.getParentsIds(),function(e){return[this.getPerson(e[0]),this.getPerson(e[1])]},this)},getSpouseIds:function(){var t=this.getPrimaryId();return e.uniq(e.map(e.filter(this.relationships,function(e){return"http://gedcomx.org/Couple"===e.type&&(e.person1.resourceId===t||e.person2.resourceId===t)}),function(e){return e.person1.resourceId===t?e.person2.resourceId:e.person1.resourceId}))},getSpouses:function(){return e.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(t){var r=this.getPrimaryId();return e.uniq(e.map(e.filter(this.childAndParentsRelationships,function(e){return n(e,r)&&(!t||n(e,t))}),function(e){return e.child.resourceId}))},getChildren:function(t){return e.map(this.getChildIds(t),this.getPerson,this)}};return r.getPersonChangeSummary=function(n,r,o){return t.get("/platform/tree/persons/"+encodeURI(n)+"/change-summary",r,{Accept:"application/x-gedcomx-atom+json"},o,e.objectExtender({getChanges:function(){return this.entries||[]}}))},r}),e("pedigree",["helpers","person","plumbing"],function(e,t,n){function r(t){return{getPersons:function(){return this.persons},exists:function(n){return!!e.findOrEmpty(this.persons,o(t,n)).id},getPerson:function(n){return e.findOrEmpty(this.persons,o(t,n))}}}function o(e,t){return function(n){return n.display[e]==t}}var s={};return s.getAncestry=function(o,s,i){return n.get("/platform/tree/ancestry",e.removeEmptyProperties(e.extend({person:o},s)),{},i,e.compose(e.objectExtender(r("ascendancyNumber")),t.personExtender,e.objectExtender({getAscendancyNumber:function(){return this.display.ascendancyNumber}},t.personExtensionPointGetter)))},s.getDescendancy=function(o,s,i){return n.get("/platform/tree/descendancy",e.removeEmptyProperties(e.extend({person:o},s)),{},i,e.compose(e.objectExtender(r("descendancyNumber")),t.personExtender,e.objectExtender({getDescendancyNumber:function(){return this.display.descendancyNumber}},t.personExtensionPointGetter)))},s}),e("searchAndMatch",["helpers","person","plumbing"],function(e,t,n){function r(e){return e=e.replace(/[:"]/g,"").trim(),e.indexOf(" ")>=0?'"'+e+'"':e}function o(t){var n=[];return e.forEach(t,function(e,t){c[t]||n.push(t+":"+r(e))}),n.join(" ")}var s=e.maybe,i={};i.getPersonSearch=function(r,i){return n.get("/platform/tree/search",e.removeEmptyProperties({q:o(r),start:r.start,count:r.count,context:r.context}),{Accept:"application/x-gedcomx-atom+json"},i,e.compose(e.objectExtender({getResults:function(){return this.entries||[]}}),e.objectExtender(u,function(e){return e.entries}),e.objectExtender(t.personConvenienceFunctions,function(t){return e.flatMap(t.entries,function(e){return s(s(e.content).gedcomx).persons})}),function(e,t){return e.getContext=function(){return t.getResponseHeader("X-fs-page-context")},e}))};var c={start:!0,count:!0,context:!0},u={getId:function(){return this.id},getTitle:function(){return this.title},getScore:function(){return this.score},getConfidence:function(){return this.confidence},getPerson:function(t){return e.findOrEmpty(s(s(this.content).gedcomx).persons,{id:t})},getPrimaryPerson:function(){return this.getPerson(this.getId())},getFatherIds:function(){var t=this.getId(),n=this;return e.uniq(e.map(e.filter(s(s(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person2.resourceId===t&&e.person1&&"http://gedcomx.org/Male"===s(n.getPerson(e.person1.resourceId).gender).type}),function(e){return e.person1.resourceId}))},getFathers:function(){return e.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){var t=this.getId(),n=this;return e.uniq(e.map(e.filter(s(s(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person2.resourceId===t&&e.person1&&"http://gedcomx.org/Male"!==s(n.getPerson(e.person1.resourceId).gender).type}),function(e){return e.person1.resourceId}))},getMothers:function(){return e.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){var t=this.getId();return e.uniq(e.map(e.filter(s(s(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/Couple"===e.type&&(e.person1.resourceId===t||e.person2.resourceId===t)}),function(e){return e.person1.resourceId===t?e.person2.resourceId:e.person1.resourceId}))},getSpouses:function(){return e.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){var t=this.getId();return e.uniq(e.map(e.filter(s(s(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person1.resourceId===t&&e.person2}),function(e){return e.person2.resourceId}))},getChildren:function(){return e.map(this.getChildIds(),this.getPerson,this)}};return i}),e("sources",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonSourceReferences=function(r,s,i){return t.get("/platform/tree/persons/"+encodeURI(r)+"/source-references",s,{},i,e.compose(e.objectExtender({getSources:function(){return n(n(this.persons)[0]).sources||[]}}),e.objectExtender(o,function(e){return n(n(e.persons)[0]).sources})))};var o={getSourceId:function(){return this.description?this.description.replace(/.*\//,"").replace(/\?.*$/,""):this.description},getTags:function(){return this.tags||[]},getContributorId:function(){return n(n(this.attribution).contributor).resourceId},getModifiedTimestamp:function(){return n(this.attribution).modified},getChangeMessage:function(){return n(this.attribution).changeMessage}};r.getSourceDescription=function(n,r,o){return t.get("/platform/sources/descriptions/"+encodeURI(n),r,{},o,e.objectExtender(s))};var s={getId:function(){return n(n(this.sourceDescriptions)[0]).id},getTitle:function(){return n(n(n(n(this.sourceDescriptions)[0]).titles)[0]).value},getTitles:function(){return e.map(n(n(this.sourceDescriptions)[0]).titles,function(e){return e.value})},getCitations:function(){return e.map(n(n(this.sourceDescriptions)[0]).citations,function(e){return e.value})},getNotes:function(){return e.map(n(n(this.sourceDescriptions)[0]).notes,function(e){return e.text})},getAbout:function(){return n(n(this.sourceDescriptions)[0]).about}};return r}),e("user",["globals","helpers","plumbing"],function(e,t,n){function r(e,t){var n=null,r=t.getResponseHeader("Location");if(r||(r=t.getResponseHeader("Content-Location")),r){var o=r.match(/\/persons\/([^?]*)/);o&&(n=o[1])}n?e.resolve(n):e.reject("not found")}var o={};o.getCurrentUser=function(e,r){return n.get("/platform/users/current",e,{},r,t.objectExtender(s))};var s={getContactName:function(){return this.users[0].contactName},getFullName:function(){return this.users[0].fullName},getEmail:function(){return this.users[0].email},getId:function(){return this.users[0].id},getTreeUserId:function(){return this.users[0].treeUserId}};o.getCurrentUserPerson=function(o,s){var i=n.get("/platform/tree/current-person",o,{},s),c=e.deferredWrapper(),u=t.extendHttpPromise(c.promise,i);return i.then(function(){r(c,i)},function(){r(c,i)}),u},o.getAgent=function(e,r,o){return n.get("/platform/users/agents/"+encodeURI(e),r,{},o,t.objectExtender(i))};var i={getId:function(){return t.firstOrEmpty(this.agents).id},getName:function(){return t.firstOrEmpty(t.firstOrEmpty(this.agents).names).value},getAccountName:function(){return t.firstOrEmpty(t.firstOrEmpty(this.agents).accounts).accountName},getEmail:function(){var e;return(e=t.firstOrEmpty(t.firstOrEmpty(this.agents).emails).resource)?e.replace(/^mailto:/,""):e}};return o}),e("FamilySearch",["init","authentication","changeHistory","discussions","memories","notes","pedigree","person","searchAndMatch","sources","user","plumbing"],function(e,t,n,r,o,s,i,c,u,a,p,f){return{init:e.init,getAuthCode:t.getAuthCode,getAccessToken:t.getAccessToken,hasAccessToken:t.hasAccessToken,invalidateAccessToken:t.invalidateAccessToken,getPersonChangeHistory:n.getPersonChangeHistory,getPersonDiscussionReferences:r.getPersonDiscussionReferences,getDiscussion:r.getDiscussion,getComments:r.getComments,getPersonMemoryReferences:o.getPersonMemoryReferences,getMemory:o.getMemory,getMemoryComments:o.getMemoryComments,getMemoryPersonas:o.getMemoryPersonas,getPersonPortraitURL:o.getPersonPortraitURL,getPersonMemories:o.getPersonMemories,getUserMemories:o.getUserMemories,getPersonNotes:s.getPersonNotes,getPersonNote:s.getPersonNote,getAncestry:i.getAncestry,getDescendancy:i.getDescendancy,getPerson:c.getPerson,getMultiPerson:c.getMultiPerson,getPersonWithRelationships:c.getPersonWithRelationships,getPersonChangeSummary:c.getPersonChangeSummary,getPersonSearch:u.getPersonSearch,getPersonSourceReferences:a.getPersonSourceReferences,getSourceDescription:a.getSourceDescription,getCurrentUser:p.getCurrentUser,getCurrentUserPerson:p.getCurrentUserPerson,getAgent:p.getAgent,get:f.get,post:f.post,put:f.put,del:f.del,http:f.http,getTotalProcessingTime:f.getTotalProcessingTime,setTotalProcessingTime:f.setTotalProcessingTime}}),t("FamilySearch")});