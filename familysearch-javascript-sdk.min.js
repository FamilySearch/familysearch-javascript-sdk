/**
 * @preserve FamilySearch JavaScript SDK
 * (c) 2013 Dallan Quass and other contributors
 * Released under the MIT license
 * http://github.com/rootsdev/familysearch-javascript-sdk
 */

!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FamilySearch=t()}(this,function(){function e(e,t,r){n[e]={deps:3===arguments.length?t:[],fn:3===arguments.length?r:t}}function t(e){var o=n[e],i=[],s=o.fn;if("function"==typeof s){for(var c=0,u=o.deps.length;u>c;c++){var a=o.deps[c],p=r[a];void 0===p&&(p=t(a),r[a]=p),i.push(p)}s=o.fn.apply(this,i)}return s}var n={},r={};return e("globals",{appKey:null,environment:null,httpWrapper:null,deferredWrapper:null,authCallbackUri:null,autoSignin:!1,accessToken:null,saveAccessToken:!1,logging:!1,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:5,server:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://sandbox.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",production:"https://ident.familysearch.org/cis-web/oauth2/v3"}}),e("helpers",["globals"],function(e){function t(e,t){return t.match(/^https?:\/\//)?t:e+("/"!==t.charAt(0)?"/":"")+t}var n={};n.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"==Object.prototype.toString.call(e)},n.isNumber=function(e){return"[object Number]"==Object.prototype.toString.call(e)},n.isString=function(e){return"[object String]"==Object.prototype.toString.call(e)},n.isFunction=function(e){return"function"!=typeof/./?"function"==typeof e:"[object Function]"==Object.prototype.toString.call(e)},n.isObject=function(e){return e===Object(e)},n.isUndefined=function(e){return void 0===e};var r=n.forEach=function(e,t,n){if(null!=e)if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;o>r;r++)if(t.call(n,e[r],r,e)==={})return}else for(var i in e)if(e.hasOwnProperty(i)&&t.call(n,e[i],i,e)==={})return};return n.keys=Object.keys||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},n.filter=function(e,t,n){var o=[];return r(e,function(e){t.call(n,e)&&o.push(e)}),o},n.map=function(e,t,n){var o=[];return r(e,function(e,r,i){o.push(t.call(n,e,r,i))}),o},n.contains=function(e,t){if(null==e)return!1;if(e.indexOf&&e.indexOf===Array.prototype.indexOf)return-1!==e.indexOf(t);var n=!1;return r(e,function(e){e===t&&(n=!0)}),n},n.uniq=function(e){var t=[];return r(e,function(e){n.contains(t,e)||t.push(e)}),t},n.find=function(e,t,r){var o,i=n.isFunction(t);if(e)for(var s=0,c=e.length;c>s;s++){var u,a=e[s];if(i)u=t.call(r,a);else{u=!0;for(var p in t)if(t.hasOwnProperty(p)&&a[p]!==t[p]){u=!1;break}}if(u){o=a;break}}return o},n.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},n.flatten=function(e){var t=[];return r(e,function(e){n.isArray(e)&&Array.prototype.push.apply(t,e)}),t},n.flatMap=n.compose(n.flatten,n.map),n.union=function(){return n.uniq(n.flatten(arguments))},n.findOrFirst=function(e,t){var r=n.find(e,t);return n.isUndefined(r)?e[0]:r},n.extend=function(e){return e=e||{},r(Array.prototype.slice.call(arguments,1),function(t){t&&r(t,function(t,n){e[n]=t})}),e},n.partialRight=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,Array.prototype.slice.call(arguments,0).concat(t))}},n.maybe=function(e){return null!=e?e:{}},n.objectExtender=function(e,t){return t?function(o){return o&&r(t(o),function(t){n.extend(t,e)}),o}:n.partialRight(n.extend,e)},n.wrapFunctions=function(e,t,n){return r(n,function(n){e[n]=function(){return t[n].apply(t,arguments)}}),e},n.extendHttpPromise=function(e,t){return n.wrapFunctions(e,t,["getResponseHeader","getAllResponseHeaders","getStatusCode"])},n.removeEmptyProperties=function(e){return r(e,function(t,n){(null==t||""===t)&&delete e[n]}),e},n.getOAuthServerUrl=function(n){return t(e.oauthServer[e.environment],n)},n.getServerUrl=function(n){return t(e.server[e.environment],n)},n.encodeQueryString=function(e){var t=[];return r(e,function(e,n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}),t.join("&")},n.appendQueryParameters=function(e,t){var r=n.encodeQueryString(t);return 0===r.length?e:e+(e.indexOf("?")>=0?"&":"?")+r},n.decodeQueryString=function(e){var t={},n=e.substring(e.indexOf("?")+1).split("&");return r(n,function(e){var n=e.split("=",2);n&&n[0]&&(t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]))}),t},n.nextTick=function(e){setTimeout(function(){e()},0)},n.refPromise=function(t){return t&&n.isFunction(t.then)?t:{then:function(r){var o=e.deferredWrapper();return n.nextTick(function(){o.resolve(r(t))}),o.promise}}},n.promiseAll=function(t){var o=e.deferredWrapper(),i=0,s=n.isArray(t)?[]:{};return r(t,function(e,t){i++,n.refPromise(e).then(function(e){s.hasOwnProperty(t)||(s[t]=e,--i||o.resolve(s))},function(){s.hasOwnProperty(t)||o.reject.apply(o,arguments)})}),0===i&&o.resolve(s),o.promise},n.createCookie=function(e,t,n){var r="";if(n){var o=new Date;o.setTime(o.getTime()+86400*n),r="; expires="+o.toUTCString()}document.cookie=e+"="+t+r+"; path=/"},n.readCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},n.eraseCookie=function(e){n.createCookie(e,"",-1)},n.eraseAccessToken=function(){e.accessToken=null,e.saveAccessToken&&n.eraseCookie(e.accessTokenCookie)},n}),e("jquery-wrappers",["globals","helpers"],function(e,t){var n={};return n.httpWrapper=function(n){return function(r,o,i,s,c){c=t.extend({url:o,type:r,dataType:"json",data:s},c),c.headers=t.extend({},i,c.headers);var u=n(c),a=e.deferredWrapper(),p=a.promise,f=null;return u.then(function(e,t,n){f=n.status,a.resolve(e)},function(e,t,n){f=e.status,a.reject(e,t,n)}),t.wrapFunctions(p,u,["getResponseHeader","getAllResponseHeaders"]),p.getStatusCode=function(){return f},p}},n.deferredWrapper=function(e){return function(){var t=e();return{promise:t.promise(),resolve:t.resolve,reject:t.reject}}},n}),e("init",["globals","jquery-wrappers","helpers"],function(e,t,n){var r={};return r.init=function(r){if(r=r||{},!r.app_key)throw"app_key must be set";if(e.appKey=r.app_key,!r.environment)throw"environment must be set";if(e.environment=r.environment,!r.http_function)throw"http must be set; e.g., jQuery.ajax";if(e.httpWrapper=t.httpWrapper(r.http_function),!r.deferred_function)throw"deferred_function must be set; e.g., jQuery.Deferred";e.deferredWrapper=t.deferredWrapper(r.deferred_function),r.auth_callback&&(e.authCallbackUri=r.auth_callback),r.auto_signin&&(e.autoSignin=r.auto_signin),r.save_access_token&&(e.saveAccessToken=!0,e.accessToken=n.readCookie(e.accessTokenCookie)),r.access_token&&(e.accessToken=r.access_token),e.logging=r.logging},r}),e("plumbing",["globals","helpers"],function(e,t){var n=0,r={};return r.getTotalProcessingTime=function(){return n},r.setTotalProcessingTime=function(e){n=e},r.get=function(e,n,o,i,s){return r.http("GET",t.appendQueryParameters(e,n),t.extend({Accept:"application/x-gedcomx-v1+json"},o),{},i,s)},r.post=function(e,n,o,i,s){return r.http("POST",e,t.extend({"Content-type":"application/x-www-form-urlencoded"},o),n,i,s)},r.put=function(e,n,o,i,s){return r.http("PUT",e,t.extend({"Content-type":"application/x-www-form-urlencoded"},o),n,i,s)},r.del=function(e,t,n,o){return r.http("DELETE",e,t,{},n,o)},r.http=function(o,i,s,c,u,a,p){var f=t.getServerUrl(i);e.accessToken&&(f=t.appendQueryParameters(f,{access_token:e.accessToken})),null==p&&(p=e.maxHttpRequestRetries);var d=e.httpWrapper(o,f,s||{},c||{},u||{}),g=e.deferredWrapper(),h=t.extendHttpPromise(g.promise,d);return d.then(function(e){var t=d.getResponseHeader("X-PROCESSING-TIME");t&&(n+=parseInt(t,10)),a&&(e=a(e,d)),g.resolve(e)},function(){var n=d.getStatusCode();if(console.log("http failure",n,p,d.getAllResponseHeaders()),401===n&&t.eraseAccessToken(),p>0&&(429===n||401===n&&e.autoSignin)){var f=0;if(429===n){var l=d.getResponseHeader("Retry-After");console.log("retryAfter",l,d.getAllResponseHeaders()),f=l?parseInt(l,10):e.defaultThrottleRetryAfter}e.getAccessToken().then(function(){setTimeout(function(){d=r.http(o,i,s,c,u,a,p-1),t.extendHttpPromise(h,d),d.then(function(e){g.resolve(e)},function(){g.reject.apply(g,arguments)})},f)})}else g.reject.apply(g,arguments)}),h},r}),e("authentication",["globals","helpers","plumbing"],function(e,t,n){function r(e,n){var r=t.isUndefined(window.screenX)?window.screenLeft:window.screenX,o=t.isUndefined(window.screenY)?window.screenTop:window.screenY,i=t.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,s=t.isUndefined(window.outerHeight)?document.documentElement.clientHeight-22:window.outerHeight,c=n.width||780,u=n.height||500,a=parseInt(r+(i-c)/2,10),p=parseInt(o+(s-u)/2.5,10),f="width="+c+",height="+u+",left="+a+",top="+p;return window.open(t.appendQueryParameters(e,n),"",f)}function o(n){var r=e.deferredWrapper();if(n)var o=setInterval(function(){try{if(n.location.hostname===window.location.hostname){var e=t.decodeQueryString(n.location.href);clearInterval(o),n.close(),e.code?r.resolve(e.code):r.reject(e.error)}}catch(i){}},e.authCodePollDelay);else r.reject("Popup blocked");return r.promise}var i={};return i.getAuthCode=function(){var n=r(t.getOAuthServerUrl("authorization"),{response_type:"code",client_id:e.appKey,redirect_uri:e.authCallbackUri});return o(n)},e.getAccessToken=i.getAccessToken=function(r){var o=e.deferredWrapper();if(e.accessToken)t.nextTick(function(){o.resolve(e.accessToken)});else{var s;s=r?t.refPromise(r):i.getAuthCode(),s.then(function(r){var i=n.post(t.getOAuthServerUrl("token"),{grant_type:"authorization_code",code:r,client_id:e.appKey});i.then(function(n){e.accessToken=n.access_token,e.accessToken?(o.resolve(e.accessToken),e.saveAccessToken&&t.createCookie(e.accessTokenCookie,e.accessToken,0)):o.reject(n.error)},function(){o.reject.apply(o,arguments)})},function(){o.reject.apply(o,arguments)})}return o.promise},i.hasAccessToken=function(){return!!e.accessToken},i.invalidateAccessToken=function(){return t.eraseAccessToken(),n.del(t.getOAuthServerUrl("token"))},i}),e("changeHistory",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonChangeHistory=function(n,r,i){return t.get("/platform/tree/persons/"+encodeURI(n)+"/changes",r,{Accept:"application/x-gedcomx-atom+json"},i,e.compose(e.objectExtender({getChanges:function(){return this.entries||[]}}),e.objectExtender(o,function(e){return e.entries})))};var o={getId:function(){return this.id},getContributorNames:function(){return e.map(this.contributors,function(e){return e.name})},getTitle:function(){return this.title},getUpdatedTimestamp:function(){return this.updated},getChangeReason:function(){return n(n(this.changeInfo)[0]).reason}};return r}),e("discussions",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonDiscussionReferences=function(r,o,i){return t.get("/platform/tree/persons/"+encodeURI(r)+"/discussion-references",o,{Accept:"application/x-fs-v1+json"},i,e.objectExtender({getDiscussionIds:function(){return e.map(n(n(this.persons)[0])["discussion-references"],function(e){return e.replace(/^.*\//,"").replace(/\?.*$/,"")})}}))},r.getDiscussion=function(n,r,i){return t.get("/platform/discussions/discussions/"+encodeURI(n),r,{Accept:"application/x-fs-v1+json"},i,e.objectExtender(o))};var o={getId:function(){return n(n(this.discussions)[0]).id},getTitle:function(){return n(n(this.discussions)[0]).title},getDetails:function(){return n(n(this.discussions)[0]).details},getNumberOfComments:function(){return n(n(this.discussions)[0]).numberOfComments}};return r.getComments=function(r,o,i){return t.get("/platform/discussions/discussions/"+encodeURI(r)+"/comments",o,{Accept:"application/x-fs-v1+json"},i,e.objectExtender({getComments:function(){return n(n(this.discussions)[0]).comments||[]}}))},r}),e("memories",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonMemoryReferences=function(r,i,s){return t.get("/platform/tree/persons/"+encodeURI(r)+"/memory-references",i,{},s,e.compose(e.objectExtender({getMemories:function(){return n(n(this.persons)[0]).evidence||[]}}),e.objectExtender(o,function(e){return n(n(e.persons)[0]).evidence})))};var o={getMemoryId:function(){return this.resource?this.resource.replace(/^.*\/memories\/(\d+)\/.*$/,"$1"):this.resource},getPersonaId:function(){return this.resourceId}};r.getPersonMemories=function(n,r,o){return t.get("/platform/tree/persons/"+encodeURI(n)+"/memories",r,{},o,e.compose(e.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),e.objectExtender(i,function(e){return e.sourceDescriptions})))};var i={getId:function(){return this.id},getArtifactURL:function(){return this.about},getTitle:function(){return n(n(this.titles)[0]).value},getTitles:function(){return e.map(this.titles,function(e){return e.value})},getDescription:function(){return n(n(this.description)[0]).value},getDescriptions:function(){return e.map(this.description,function(e){return e.value})},getArtifactFilenames:function(){return e.map(this.artifactMetadata,function(e){return e.filename})}};r.getUserMemories=function(n,r,o){return t.get("/platform/memories/users/"+encodeURI(n)+"/memories",r,{},o,e.compose(e.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),e.objectExtender(i,function(e){return e.sourceDescriptions})))},r.getMemory=function(n,r,o){return t.get("/platform/memories/memories/"+encodeURI(n),r,{},o,e.objectExtender(s))};var s={getId:function(){return n(n(this.sourceDescriptions)[0]).id},getMediaType:function(){return n(n(this.sourceDescriptions)[0]).mediaType},getArtifactURL:function(){return n(n(this.sourceDescriptions)[0]).about},getIconURL:function(){return n(n(n(n(this.sourceDescriptions)[0]).links)["image-icon"]).href},getThumbnailURL:function(){return n(n(n(n(this.sourceDescriptions)[0]).links)["image-thumbnail"]).href},getTitle:function(){return n(n(n(n(this.sourceDescriptions)[0]).titles)[0]).value},getTitles:function(){return e.map(n(n(this.sourceDescriptions)[0]).titles,function(e){return e.value})},getDescription:function(){return n(n(n(n(this.sourceDescriptions)[0]).description)[0]).value},getDescriptions:function(){return e.map(n(n(this.sourceDescriptions)[0]).description,function(e){return e.value})}};return r.getMemoryComments=function(r,o,i){return t.get("/platform/memories/memories/"+encodeURI(r)+"/comments",o,{Accept:"application/x-fs-v1+json"},i,e.objectExtender({getComments:function(){return n(n(this.discussions)[0]).comments||[]}}))},r.getMemoryPersonas=function(n,r,o){return t.get("/platform/memories/memories/"+encodeURI(n)+"/personas",r,{},o,e.objectExtender({getPersonas:function(){return this.persons||[]}}))},r.getPersonPortraitURL=function(t){return e.getServerUrl("/platform/tree/persons/"+encodeURI(t)+"/portrait")},r}),e("notes",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonNotes=function(r,o,i){return t.get("/platform/tree/persons/"+encodeURI(r)+"/notes",o,{},i,e.objectExtender({getNotes:function(){return n(n(this.persons)[0]).notes||[]}}))},r.getPersonNote=function(n,r,i,s){return t.get("/platform/tree/persons/"+encodeURI(n)+"/notes/"+encodeURI(r),i,{},s,e.objectExtender(o))};var o={getPersonId:function(){return n(n(this.persons)[0]).id},getNoteId:function(){return n(n(n(n(this.persons)[0]).notes)[0]).id},getSubject:function(){return n(n(n(n(this.persons)[0]).notes)[0]).subject},getText:function(){return n(n(n(n(this.persons)[0]).notes)[0]).text}};return r}),e("person",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPerson=function(n,o,i){return t.get("/platform/tree/persons/"+encodeURI(n),o,{},i,e.compose(e.objectExtender({getPerson:function(){return this.persons[0]}}),r.personExtender))},r.personExtensionPointGetter=function(e){return e.persons},r.personConvenienceFunctions={getId:function(){return this.id},getBirthDate:function(){return this.display.birthDate},getBirthPlace:function(){return this.display.birthPlace},getDeathDate:function(){return this.display.deathDate},getDeathPlace:function(){return this.display.deathPlace},getGender:function(){return this.display.gender},getLifeSpan:function(){return this.display.lifespan},isLiving:function(){return this.living},getName:function(){return this.display.name},getGivenName:function(){return n(e.find(n(n(n(e.findOrFirst(this.names,{preferred:!0})).nameForms)[0]).parts,{type:"http://gedcomx.org/Given"})).value},getSurname:function(){return n(e.find(n(n(n(e.findOrFirst(this.names,{preferred:!0})).nameForms)[0]).parts,{type:"http://gedcomx.org/Surname"})).value},getNames:function(){return this.names},getFacts:function(){return this.facts},getDisplayAttrs:function(){return this.display}};var o={getId:function(){return this.id},getContributor:function(){return n(n(this.attribution).contributor).resourceId},getType:function(){return this.type},getNameFormsCount:function(){return this.nameForms?this.nameForms.length:0},getFullText:function(e){return n(n(this.nameForms)[e||0]).fullText},getGivenName:function(t){return n(e.find(n(n(this.nameForms)[t||0]).parts,{type:"http://gedcomx.org/Given"})).value},getSurname:function(t){return n(e.find(n(n(this.nameForms)[t||0]).parts,{type:"http://gedcomx.org/Surname"})).value},isPreferred:function(){return this.preferred}};r.factConvenienceFunctions={getId:function(){return this.id},getContributor:function(){return n(n(this.attribution).contributor).resourceId},getType:function(){return this.type},getDate:function(){return n(this.date).original},getFormalDate:function(){return n(this.date).formal},getPlace:function(){return n(this.place).original}},r.personExtender=e.compose(e.objectExtender(r.personConvenienceFunctions,r.personExtensionPointGetter),e.objectExtender(o,function(t){return e.flatMap(t.persons,function(e){return e.names})}),e.objectExtender(r.factConvenienceFunctions,function(t){return e.flatMap(t.persons,function(e){return e.facts})})),r.getMultiPerson=function(t,n,o){var i={};return e.forEach(t,function(e){i[e]=r.getPerson(e,n,o)}),e.promiseAll(i)},r.getPersonWithRelationships=function(n,o,u){return t.get("/platform/tree/persons-with-relationships",e.removeEmptyProperties(e.extend({person:n},o)),{},u,e.compose(e.objectExtender({getPrimaryId:function(){return n}}),e.objectExtender(r.factConvenienceFunctions,function(t){return e.union(e.flatMap(t.childAndParentsRelationships,function(t){return e.union(t.fatherFacts,t.motherFacts)}),e.flatMap(t.getSpouseRelationships(),function(e){return e.facts}))}),e.objectExtender({getPrimaryId:function(){return n}},function(e){return e.getSpouseRelationships()}),e.objectExtender(s,function(e){return e.getSpouseRelationships()}),e.objectExtender(c,function(e){return e.childAndParentsRelationships}),e.objectExtender(i),r.personExtender))};var i={getPerson:function(t){return e.find(this.persons,{id:t})},getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getParentRelationships:function(){var t=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(e){return n(e.child).resourceId===t})},getSpouseRelationships:function(){return e.filter(this.relationships,function(e){return"http://gedcomx.org/Couple"===e.type})},getChildRelationships:function(){var t=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(e){return n(e.father).resourceId===t||n(e.mother).resourceId===t})},getFatherIds:function(){return e.uniq(e.map(e.filter(this.getParentRelationships(),function(e){return!!e.getFatherId()}),function(e){return e.getFatherId()},this))},getFathers:function(){return e.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){return e.uniq(e.map(e.filter(this.getParentRelationships(),function(e){return!!e.getMotherId()}),function(e){return e.getMotherId()},this))},getMothers:function(){return e.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){return e.uniq(e.map(e.filter(this.getSpouseRelationships(),function(e){return!!e.getSpouseId()}),function(e){return e.getSpouseId()},this))},getSpouses:function(){return e.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(t){return e.uniq(e.map(e.filter(this.getChildRelationships(),function(e){return!(!e.getChildId()||t&&e.getFatherId()!==t&&e.getMotherId()!==t)}),function(e){return e.getChildId()},this))},getChildren:function(t){return e.map(this.getChildIds(t),this.getPerson,this)}},s={getId:function(){return this.id},getHusbandId:function(){return n(this.person1).resourceId},getWifeId:function(){return n(this.person2).resourceId},getSpouseId:function(){return this.getHusbandId()===this.getPrimaryId()?this.getWifeId():this.getHusbandId()},getFacts:function(){return this.facts||[]}},c={getId:function(){return this.id},getFatherId:function(){return n(this.father).resourceId},getMotherId:function(){return n(this.mother).resourceId},getChildId:function(){return n(this.child).resourceId},getFatherFacts:function(){return this.fatherFacts||[]},getMotherFacts:function(){return this.motherFacts||[]}};r.getPersonChangeSummary=function(n,r,o){return t.get("/platform/tree/persons/"+encodeURI(n)+"/change-summary",r,{Accept:"application/x-gedcomx-atom+json"},o,e.objectExtender({getChanges:function(){return this.entries||[]}}))},r.getRelationshipsToSpouses=function(n,o,i){return t.get("/platform/tree/persons/"+encodeURI(n)+"/spouse-relationships",o,{},i,e.compose(e.objectExtender({getPrimaryId:function(){return n}}),e.objectExtender(u),e.objectExtender({getPrimaryId:function(){return n}},function(e){return e.relationships}),e.objectExtender(s,function(e){return e.relationships}),e.objectExtender(r.factConvenienceFunctions,function(t){return e.flatMap(t.relationships,function(e){return e.facts})}),r.personExtender))};var u={getRelationships:function(){return this.relationships||[]},getSpouseIds:function(){var t=this.getPrimaryId();return e.uniq(e.map(this.getRelationships(),function(e){return e.getHusbandId()===t?e.getWifeId():e.getHusbandId()},this))},getPerson:function(t){return e.find(this.persons,{id:t})}};r.getRelationshipsToParents=function(n,o,i){return t.get("/platform/tree/persons/"+encodeURI(n)+"/parent-relationships",o,{},i,e.compose(e.objectExtender(p),r.personExtender))};var a="http://familysearch.org/v1/ChildAndParentsRelationship",p={getRelationships:function(){return e.map(e.uniq(e.map(e.filter(this.relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&!!n(e.identifiers)[a]}),function(e){return e.identifiers[a]},this)),function(t){return{id:t.replace(/^.*\//,"").replace(/\?.*$/,""),fatherId:n(n(e.find(this.relationships,function(e){return n(e.identifiers)[a]===t&&!!n(e.links).father})).person1).resourceId,motherId:n(n(e.find(this.relationships,function(e){return n(e.identifiers)[a]===t&&!!n(e.links).mother})).person1).resourceId}},this)},getPerson:function(t){return e.find(this.persons,{id:t})}};r.getRelationshipsToChildren=function(n,o,i){return t.get("/platform/tree/persons/"+encodeURI(n)+"/child-relationships",o,{},i,e.compose(e.objectExtender(f),e.objectExtender(d,function(e){return e.relationships}),r.personExtender))};var f={getRelationships:function(){return this.relationships||[]},getChildIds:function(){return e.uniq(e.map(this.getRelationships(),function(e){return e.getChildId()},this))},getPerson:function(t){return e.find(this.persons,{id:t})}},d={getId:function(){return this.id},getChildId:function(){return n(this.person2).resourceId}};return r}),e("parentsAndChildren",["helpers","person","plumbing"],function(e,t,n){var r=e.maybe,o={};o.getChildAndParents=function(o,s,c){return n.get("/platform/tree/child-and-parents-relationships/"+encodeURI(o),s,{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender(i),e.objectExtender(t.factConvenienceFunctions,function(t){return e.union(r(r(t.childAndParentsRelationships)[0]).fatherFacts,r(r(t.childAndParentsRelationships)[0]).motherFacts)}),t.personExtender))};var i={getId:function(){return r(r(this.childAndParentsRelationships)[0]).id},getFatherId:function(){return r(r(r(this.childAndParentsRelationships)[0]).father).resourceId},getMotherId:function(){return r(r(r(this.childAndParentsRelationships)[0]).mother).resourceId},getChildId:function(){return r(r(r(this.childAndParentsRelationships)[0]).child).resourceId},getFatherFacts:function(){return r(r(this.childAndParentsRelationships)[0]).fatherFacts},getMotherFacts:function(){return r(r(this.childAndParentsRelationships)[0]).motherFacts},getPerson:function(t){return e.find(this.persons,{id:t})}};return o}),e("pedigree",["helpers","person","plumbing"],function(e,t,n){function r(t){return{getPersons:function(){return this.persons},exists:function(n){return!!i(e.find(this.persons,o(t,n))).id},getPerson:function(n){return e.find(this.persons,o(t,n))}}}function o(e,t){return function(n){return n.display[e]==t}}var i=e.maybe,s={};return s.getAncestry=function(o,i,s){return n.get("/platform/tree/ancestry",e.removeEmptyProperties(e.extend({person:o},i)),{},s,e.compose(e.objectExtender(r("ascendancyNumber")),t.personExtender,e.objectExtender({getAscendancyNumber:function(){return this.display.ascendancyNumber}},t.personExtensionPointGetter)))},s.getDescendancy=function(o,i,s){return n.get("/platform/tree/descendancy",e.removeEmptyProperties(e.extend({person:o},i)),{},s,e.compose(e.objectExtender(r("descendancyNumber")),t.personExtender,e.objectExtender({getDescendancyNumber:function(){return this.display.descendancyNumber}},t.personExtensionPointGetter)))},s}),e("searchAndMatch",["helpers","person","plumbing"],function(e,t,n){function r(e){return e=e.replace(/[:"]/g,"").trim(),e.indexOf(" ")>=0?'"'+e+'"':e}function o(t){return e.map(e.filter(e.keys(t),function(e){return!c[e]}),function(e){return e+":"+r(t[e])}).join(" ")}var i=e.maybe,s={};s.getPersonSearch=function(t,r){return n.get("/platform/tree/search",e.removeEmptyProperties({q:o(t),start:t.start,count:t.count,context:t.context}),{Accept:"application/x-gedcomx-atom+json"},r,e.compose(a,function(e,t){return e.getContext=function(){return t.getResponseHeader("X-fs-page-context")},e}))};var c={start:!0,count:!0,context:!0},u={getId:function(){return this.id},getTitle:function(){return this.title},getScore:function(){return this.score},getConfidence:function(){return this.confidence},getPerson:function(t){return e.find(i(i(this.content).gedcomx).persons,{id:t})},getPrimaryPerson:function(){return this.getPerson(this.getId())},getFatherIds:function(){var t=this.getId(),n=this;return e.uniq(e.map(e.filter(i(i(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person2.resourceId===t&&e.person1&&"http://gedcomx.org/Male"===i(n.getPerson(e.person1.resourceId).gender).type}),function(e){return e.person1.resourceId}))},getFathers:function(){return e.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){var t=this.getId(),n=this;return e.uniq(e.map(e.filter(i(i(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person2.resourceId===t&&e.person1&&"http://gedcomx.org/Male"!==i(n.getPerson(e.person1.resourceId).gender).type}),function(e){return e.person1.resourceId}))},getMothers:function(){return e.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){var t=this.getId();return e.uniq(e.map(e.filter(i(i(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/Couple"===e.type&&(e.person1.resourceId===t||e.person2.resourceId===t)}),function(e){return e.person1.resourceId===t?e.person2.resourceId:e.person1.resourceId}))},getSpouses:function(){return e.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){var t=this.getId();return e.uniq(e.map(e.filter(i(i(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person1.resourceId===t&&e.person2}),function(e){return e.person2.resourceId}))},getChildren:function(){return e.map(this.getChildIds(),this.getPerson,this)}},a=e.compose(e.objectExtender({getResults:function(){return this.entries||[]}}),e.objectExtender(u,function(e){return e.entries}),e.objectExtender(t.personConvenienceFunctions,function(t){return e.flatMap(t.entries,function(e){return i(i(e.content).gedcomx).persons})}));return s.getPersonMatches=function(e,t,r){return n.get("/platform/tree/persons/"+encodeURI(e)+"/matches",t,{Accept:"application/x-gedcomx-atom+json"},r,a)},s.getPersonMatchesQuery=function(t,r){return n.get("/platform/tree/matches",e.removeEmptyProperties({q:o(t),start:t.start,count:t.count}),{Accept:"application/x-gedcomx-atom+json"},r,a)},s}),e("sourceBox",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getCollectionsForUser=function(n,r,o){return t.get("/platform/sources/"+encodeURI(n)+"/collections",{},{Accept:"application/x-fs-v1+json"},o,e.objectExtender({getCollectionIds:function(){return e.map(this.collections,function(e){return e.id})}}))},r.getCollection=function(n,r,i){return t.get("/platform/sources/collections/"+encodeURI(n),r,{Accept:"application/x-fs-v1+json"},i,e.objectExtender(o))};var o={getId:function(){return n(n(this.collections)[0]).id},getTitle:function(){return n(n(this.collections)[0]).title}};r.getCollectionSourceDescriptions=function(n,r,o){return t.get("/platform/sources/collections/"+encodeURI(n)+"/descriptions",r,{Accept:"application/x-fs-v1+json"},o,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),e.objectExtender(i,function(e){return e.sourceDescriptions})))};var i={getId:function(){return this.id},getTitle:function(){return n(n(this.titles)[0]).value},getTitles:function(){return e.map(this.titles,function(e){return e.value})}};return r.getCollectionSourceDescriptionsForUser=function(n,r,o){return t.get("/platform/sources/"+encodeURI(n)+"/collections/descriptions",r,{Accept:"application/x-fs-v1+json"},o,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),e.objectExtender(i,function(e){return e.sourceDescriptions})))},r}),e("sources",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonSourceReferences=function(r,i,s){return t.get("/platform/tree/persons/"+encodeURI(r)+"/source-references",i,{},s,e.compose(e.objectExtender({getSources:function(){return n(n(this.persons)[0]).sources||[]}}),e.objectExtender(o,function(e){return n(n(e.persons)[0]).sources})))};var o={getSourceId:function(){return this.description?this.description.replace(/.*\//,"").replace(/\?.*$/,""):this.description},getTags:function(){return this.tags||[]},getContributorId:function(){return n(n(this.attribution).contributor).resourceId},getModifiedTimestamp:function(){return n(this.attribution).modified},getChangeMessage:function(){return n(this.attribution).changeMessage}};r.getSourceDescription=function(n,r,o){return t.get("/platform/sources/descriptions/"+encodeURI(n),r,{},o,e.objectExtender(i))};var i={getId:function(){return n(n(this.sourceDescriptions)[0]).id},getTitle:function(){return n(n(n(n(this.sourceDescriptions)[0]).titles)[0]).value},getTitles:function(){return e.map(n(n(this.sourceDescriptions)[0]).titles,function(e){return e.value})},getCitations:function(){return e.map(n(n(this.sourceDescriptions)[0]).citations,function(e){return e.value})},getNotes:function(){return e.map(n(n(this.sourceDescriptions)[0]).notes,function(e){return e.text})},getAbout:function(){return n(n(this.sourceDescriptions)[0]).about}};return r}),e("spouses",["helpers","person","plumbing"],function(e,t,n){var r=e.maybe,o={};o.getCouple=function(o,s,c){return n.get("/platform/tree/couple-relationships/"+encodeURI(o),s,{},c,e.compose(e.objectExtender(i),e.objectExtender(t.factConvenienceFunctions,function(e){return r(r(e.relationships)[0]).facts
}),t.personExtender))};var i={getId:function(){return r(r(this.relationships)[0]).id},getHusbandId:function(){return r(r(r(this.relationships)[0]).person1).resourceId},getWifeId:function(){return r(r(r(this.relationships)[0]).person2).resourceId},getFacts:function(){return r(r(this.relationships)[0]).facts||[]},getPerson:function(t){return e.find(this.persons,{id:t})}};return o}),e("user",["globals","helpers","plumbing"],function(e,t,n){function r(e,t){var n=null,r=t.getResponseHeader("Location");if(r||(r=t.getResponseHeader("Content-Location")),r){var o=r.match(/\/persons\/([^?]*)/);o&&(n=o[1])}n?e.resolve(n):e.reject("not found")}var o=t.maybe,i={};i.getCurrentUser=function(e,r){return n.get("/platform/users/current",e,{},r,t.objectExtender(s))};var s={getContactName:function(){return this.users[0].contactName},getFullName:function(){return this.users[0].fullName},getEmail:function(){return this.users[0].email},getId:function(){return this.users[0].id},getTreeUserId:function(){return this.users[0].treeUserId}};i.getCurrentUserPerson=function(o,i){var s=n.get("/platform/tree/current-person",o,{},i),c=e.deferredWrapper(),u=t.extendHttpPromise(c.promise,s);return s.then(function(){r(c,s)},function(){r(c,s)}),u},i.getAgent=function(e,r,o){return n.get("/platform/users/agents/"+encodeURI(e),r,{},o,t.objectExtender(c))};var c={getId:function(){return o(o(this.agents)[0]).id},getName:function(){return o(o(o(o(this.agents)[0]).names)[0]).value},getAccountName:function(){return o(o(o(o(this.agents)[0]).accounts)[0]).accountName},getEmail:function(){var e=o(o(o(o(this.agents)[0]).emails)[0]).resource;return e?e.replace(/^mailto:/,""):e}};return i}),e("FamilySearch",["init","authentication","changeHistory","discussions","memories","notes","parentsAndChildren","pedigree","person","searchAndMatch","sourceBox","sources","spouses","user","plumbing"],function(e,t,n,r,o,i,s,c,u,a,p,f,d,g,h){return{init:e.init,getAuthCode:t.getAuthCode,getAccessToken:t.getAccessToken,hasAccessToken:t.hasAccessToken,invalidateAccessToken:t.invalidateAccessToken,getPersonChangeHistory:n.getPersonChangeHistory,getPersonDiscussionReferences:r.getPersonDiscussionReferences,getDiscussion:r.getDiscussion,getComments:r.getComments,getPersonMemoryReferences:o.getPersonMemoryReferences,getMemory:o.getMemory,getMemoryComments:o.getMemoryComments,getMemoryPersonas:o.getMemoryPersonas,getPersonPortraitURL:o.getPersonPortraitURL,getPersonMemories:o.getPersonMemories,getUserMemories:o.getUserMemories,getPersonNotes:i.getPersonNotes,getPersonNote:i.getPersonNote,getChildAndParents:s.getChildAndParents,getAncestry:c.getAncestry,getDescendancy:c.getDescendancy,getPerson:u.getPerson,getMultiPerson:u.getMultiPerson,getPersonWithRelationships:u.getPersonWithRelationships,getPersonChangeSummary:u.getPersonChangeSummary,getRelationshipsToSpouses:u.getRelationshipsToSpouses,getRelationshipsToParents:u.getRelationshipsToParents,getRelationshipsToChildren:u.getRelationshipsToChildren,getPersonSearch:a.getPersonSearch,getPersonMatches:a.getPersonMatches,getPersonMatchesQuery:a.getPersonMatchesQuery,getCollectionsForUser:p.getCollectionsForUser,getCollection:p.getCollection,getCollectionSourceDescriptions:p.getCollectionSourceDescriptions,getCollectionSourceDescriptionsForUser:p.getCollectionSourceDescriptionsForUser,getPersonSourceReferences:f.getPersonSourceReferences,getSourceDescription:f.getSourceDescription,getCouple:d.getCouple,getCurrentUser:g.getCurrentUser,getCurrentUserPerson:g.getCurrentUserPerson,getAgent:g.getAgent,get:h.get,post:h.post,put:h.put,del:h.del,http:h.http,getTotalProcessingTime:h.getTotalProcessingTime,setTotalProcessingTime:h.setTotalProcessingTime}}),t("FamilySearch")});