/**
 * @preserve FamilySearch JavaScript SDK
 * (c) 2013 Dallan Quass and other contributors
 * Released under the MIT license
 * http://github.com/rootsdev/familysearch-javascript-sdk
 */

!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FamilySearch=t()}(this,function(){function e(e,t,r){n[e]={deps:3===arguments.length?t:[],fn:3===arguments.length?r:t}}function t(e){var o=n[e],s=[],i=o.fn;if("function"==typeof i){for(var c=0,u=o.deps.length;u>c;c++){var a=o.deps[c],p=r[a];void 0===p&&(p=t(a),r[a]=p),s.push(p)}i=o.fn.apply(this,s)}return i}var n={},r={};return e("globals",{appKey:null,environment:null,httpWrapper:null,deferredWrapper:null,authCallbackUri:null,autoSignin:!1,autoExpire:!1,accessToken:null,saveAccessToken:!1,logging:!1,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:5,maxAccessTokenInactivityTime:354e4,maxAccessTokenCreationTime:8634e4,apiServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://sandbox.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",production:"https://ident.familysearch.org/cis-web/oauth2/v3"}}),e("helpers",["globals"],function(e){function t(e,t){return t.match(/^https?:\/\//)?t:e+("/"!==t.charAt(0)?"/":"")+t}function n(e,t,n){return n&&clearTimeout(n),setTimeout(function(){e()},t)}function r(e){u=n(i.eraseAccessToken,e,u)}function o(e){a=n(i.eraseAccessToken,e,a)}function s(){clearTimeout(u),u=null,clearTimeout(a),a=null}var i={};Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),i.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"==Object.prototype.toString.call(e)},i.isNumber=function(e){return"[object Number]"==Object.prototype.toString.call(e)},i.isString=function(e){return"[object String]"==Object.prototype.toString.call(e)},i.isFunction=function(e){return"function"!=typeof/./?"function"==typeof e:"[object Function]"==Object.prototype.toString.call(e)},i.isObject=function(e){return e===Object(e)},i.isUndefined=function(e){return void 0===e};var c=i.forEach=function(e,t,n){if(null!=e)if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;o>r;r++)if(t.call(n,e[r],r,e)==={})return}else for(var s in e)if(e.hasOwnProperty(s)&&t.call(n,e[s],s,e)==={})return};i.keys=Object.keys||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},i.filter=function(e,t,n){var r=[];return c(e,function(e){t.call(n,e)&&r.push(e)}),r},i.map=function(e,t,n){var r=[];return c(e,function(e,o,s){r.push(t.call(n,e,o,s))}),r},i.contains=function(e,t){if(null==e)return!1;if(e.indexOf&&e.indexOf===Array.prototype.indexOf)return-1!==e.indexOf(t);var n=!1;return c(e,function(e){e===t&&(n=!0)}),n},i.uniq=function(e){var t=[];return c(e,function(e){i.contains(t,e)||t.push(e)}),t},i.find=function(e,t,n){var r,o=i.isFunction(t);if(e)for(var s=0,c=e.length;c>s;s++){var u,a=e[s];if(o)u=t.call(n,a);else{u=!0;for(var p in t)if(t.hasOwnProperty(p)&&a[p]!==t[p]){u=!1;break}}if(u){r=a;break}}return r},i.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},i.flatten=function(e){var t=[];return c(e,function(e){i.isArray(e)&&Array.prototype.push.apply(t,e)}),t},i.flatMap=i.compose(i.flatten,i.map),i.union=function(){return i.uniq(i.flatten(arguments))},i.findOrFirst=function(e,t){var n=i.find(e,t);return i.isUndefined(n)?e[0]:n},i.extend=function(e){return e=e||{},c(Array.prototype.slice.call(arguments,1),function(t){t&&c(t,function(t,n){e[n]=t})}),e},i.partialRight=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,Array.prototype.slice.call(arguments).concat(t))}},i.partial=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}},i.maybe=function(e){return null!=e?e:{}},i.objectExtender=function(e,t){return t?function(n){return n&&c(t(n),function(t){i.extend(t,e)}),n}:i.partialRight(i.extend,e)},i.constructorSetter=function(e,t,n){var r;return n?(r=i.constructorSetter(e,t),function(e){var t=n(e);return i.isArray(t)?i.forEach(t,function(e){r(e)}):i.isObject(t)&&r(t),e}):t?(r=i.constructorSetter(e),function(e){return i.isArray(e[t])?e[t]=i.map(e[t],function(e){return r(e)}):i.isObject(e[t])&&(e[t]=r(e[t])),e}):function(t){var n=Object.create(e.prototype);return i.extend(n,t),n}},i.wrapFunctions=function(e,t,n){return c(n,function(n){e[n]=function(){return t[n].apply(t,arguments)}}),e},i.extendHttpPromise=function(e,t){return i.wrapFunctions(e,t,["getResponseHeader","getAllResponseHeaders","getStatusCode"])},i.removeEmptyProperties=function(e){return c(e,function(t,n){(null==t||""===t)&&delete e[n]}),e},i.getOAuthServerUrl=function(n){return t(e.oauthServer[e.environment],n)},i.isOAuthServerUrl=function(t){return 0===t.indexOf(e.oauthServer[e.environment])},i.getAPIServerUrl=function(n){return t(e.apiServer[e.environment],n)},i.encodeQueryString=function(e){var t=[];return c(e,function(e,n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}),t.join("&")},i.appendQueryParameters=function(e,t){var n=i.encodeQueryString(t);return 0===n.length?e:e+(e.indexOf("?")>=0?"&":"?")+n},i.decodeQueryString=function(e){var t={},n=e.substring(e.indexOf("?")+1).split("&");return c(n,function(e){var n=e.split("=",2);n&&n[0]&&(t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]))}),t},i.nextTick=function(e){setTimeout(function(){e()},0)},i.refPromise=function(t){return t&&i.isFunction(t.then)?t:{then:function(n){var r=e.deferredWrapper();return i.nextTick(function(){r.resolve(n(t))}),r.promise}}},i.promiseAll=function(t){var n=e.deferredWrapper(),r=0,o=i.isArray(t)?[]:{};return c(t,function(e,t){r++,i.refPromise(e).then(function(e){o.hasOwnProperty(t)||(o[t]=e,--r||n.resolve(o))},function(){o.hasOwnProperty(t)||n.reject.apply(n,arguments)})}),0===r&&n.resolve(o),n.promise},i.createCookie=function(e,t,n){var r="";if(n){var o=new Date;o.setTime(o.getTime()+86400*n),r="; expires="+o.toUTCString()}document.cookie=e+"="+t+r+"; path=/"},i.readCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},i.eraseCookie=function(e){i.createCookie(e,"",-1)};var u=null,a=null;return i.readAccessToken=function(){var t=(new Date).getTime(),n=i.readCookie(e.accessTokenCookie);if(n){var s=n.split("|",3);if(3===s.length){var c=t-parseInt(s[0],10),u=t-parseInt(s[1],10);c<e.maxAccessTokenInactivityTime&&u<e.maxAccessTokenCreationTime&&(e.accessToken=s[2],e.autoExpire&&(r(e.maxAccessTokenInactivityTime-c),o(e.maxAccessTokenCreationTime-u)))}}},i.setAccessToken=function(t){if(e.accessToken=t,e.autoExpire&&(r(e.maxAccessTokenInactivityTime),o(e.maxAccessTokenCreationTime)),e.saveAccessToken){var n=(new Date).getTime(),s=n+"|"+n+"|"+t;i.createCookie(e.accessTokenCookie,s,0)}},i.refreshAccessToken=function(){var t=(new Date).getTime();if(e.autoExpire&&r(e.maxAccessTokenInactivityTime),e.saveAccessToken){var n=i.readCookie(e.accessTokenCookie);if(n){var o=n.split("|",3);3===o.length&&(n=t+"|"+o[1]+"|"+o[2],i.createCookie(e.accessTokenCookie,n,0))}}},i.eraseAccessToken=function(){e.accessToken=null,e.autoExpire&&s(),e.saveAccessToken&&i.eraseCookie(e.accessTokenCookie)},i}),e("jquery-wrappers",["globals","helpers"],function(e,t){var n={};return n.httpWrapper=function(n){return function(r,o,s,i,c){c=t.extend({url:o,type:r,dataType:"json",data:i},c),c.headers=t.extend({},s,c.headers);var u=n(c),a=e.deferredWrapper(),p=a.promise,f=null;return u.then(function(e,t,n){f=n.status,a.resolve(e)},function(e,t,n){f=e.status,a.reject(e,t,n)}),t.wrapFunctions(p,u,["getResponseHeader","getAllResponseHeaders"]),p.getStatusCode=function(){return f},p}},n.deferredWrapper=function(e){return function(){var t=e();return{promise:t.promise(),resolve:t.resolve,reject:t.reject}}},n}),e("init",["globals","jquery-wrappers","helpers"],function(e,t,n){var r={};return r.init=function(r){if(r=r||{},!r.app_key)throw"app_key must be set";if(e.appKey=r.app_key,!r.environment)throw"environment must be set";if(e.environment=r.environment,!r.http_function)throw"http must be set; e.g., jQuery.ajax";if(e.httpWrapper=t.httpWrapper(r.http_function),!r.deferred_function)throw"deferred_function must be set; e.g., jQuery.Deferred";e.deferredWrapper=t.deferredWrapper(r.deferred_function),e.authCallbackUri=r.auth_callback,e.autoSignin=r.auto_signin,e.autoExpire=r.auto_expire,r.save_access_token&&(e.saveAccessToken=!0,n.readAccessToken()),r.access_token&&(e.accessToken=r.access_token)},r}),e("plumbing",["globals","helpers"],function(e,t){var n=0,r={};return r.getTotalProcessingTime=function(){return n},r.setTotalProcessingTime=function(e){n=e},r.get=function(e,n,o,s,i){return r.http("GET",t.appendQueryParameters(e,n),t.extend({Accept:"application/x-gedcomx-v1+json"},o),{},s,i)},r.post=function(e,n,o,s,i){return r.http("POST",e,t.extend({"Content-type":"application/x-www-form-urlencoded"},o),n,s,i)},r.put=function(e,n,o,s,i){return r.http("PUT",e,t.extend({"Content-type":"application/x-www-form-urlencoded"},o),n,s,i)},r.del=function(e,t,n,o){return r.http("DELETE",e,t,{},n,o)},r.http=function(o,s,i,c,u,a,p){var f,l=e.deferredWrapper(),d=l.promise,h=t.getAPIServerUrl(s);return f=e.accessToken||!e.autoSignin||t.isOAuthServerUrl(h)?t.refPromise(e.accessToken):e.getAccessToken(),f.then(function(){e.accessToken&&(h=t.appendQueryParameters(h,{access_token:e.accessToken})),null==p&&(p=e.maxHttpRequestRetries);var f=e.httpWrapper(o,h,i||{},c||{},u||{});d=t.extendHttpPromise(d,f),f.then(function(e){t.refreshAccessToken();var r=f.getResponseHeader("X-PROCESSING-TIME");r&&(n+=parseInt(r,10)),a&&(e=a(e,f)),l.resolve(e)},function(){var n=f.getStatusCode();if(console.log("http failure",n,p,f.getAllResponseHeaders()),401===n&&t.eraseAccessToken(),p>0&&429===n){var h=f.getResponseHeader("Retry-After"),g=h?parseInt(h,10):e.defaultThrottleRetryAfter;setTimeout(function(){f=r.http(o,s,i,c,u,a,p-1),t.extendHttpPromise(d,f),f.then(function(e){l.resolve(e)},function(){l.reject.apply(l,arguments)})},g)}else l.reject.apply(l,arguments)})},function(){l.reject.apply(l,arguments)}),d},r}),e("authentication",["globals","helpers","plumbing"],function(e,t,n){function r(e,n){var r=t.isUndefined(window.screenX)?window.screenLeft:window.screenX,o=t.isUndefined(window.screenY)?window.screenTop:window.screenY,s=t.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,i=t.isUndefined(window.outerHeight)?document.documentElement.clientHeight-22:window.outerHeight,c=n.width||780,u=n.height||500,a=parseInt(r+(s-c)/2,10),p=parseInt(o+(i-u)/2.5,10),f="width="+c+",height="+u+",left="+a+",top="+p;return window.open(t.appendQueryParameters(e,n),"",f)}function o(n){var r=e.deferredWrapper();if(n)var o=setInterval(function(){try{if(n.location.hostname===window.location.hostname){var e=t.decodeQueryString(n.location.href);clearInterval(o),n.close(),e.code?r.resolve(e.code):r.reject(e.error)}}catch(s){}},e.authCodePollDelay);else r.reject("Popup blocked");return r.promise}var s={};return s.getAuthCode=function(){var n=r(t.getOAuthServerUrl("authorization"),{response_type:"code",client_id:e.appKey,redirect_uri:e.authCallbackUri});return o(n)},e.getAccessToken=s.getAccessToken=function(r){var o=e.deferredWrapper();if(e.accessToken)t.nextTick(function(){o.resolve(e.accessToken)});else{var i;i=r?t.refPromise(r):s.getAuthCode(),i.then(function(r){var s=n.post(t.getOAuthServerUrl("token"),{grant_type:"authorization_code",code:r,client_id:e.appKey});s.then(function(e){var n=e.access_token;n?(t.setAccessToken(n),o.resolve(n)):o.reject(e.error)},function(){o.reject.apply(o,arguments)})},function(){o.reject.apply(o,arguments)})}return o.promise},s.hasAccessToken=function(){return!!e.accessToken},s.invalidateAccessToken=function(){return t.eraseAccessToken(),n.del(t.getOAuthServerUrl("token"))},s}),e("changeHistory",["helpers","plumbing"],function(e,t){var n=e.maybe,r={},o=r.Change=function(){};r.Change.prototype={constructor:o,getContributorName:function(){return n(n(this.contributors)[0]).name},getChangeReason:function(){return n(n(this.changeInfo)[0]).reason}};var s=e.compose(e.objectExtender({getChanges:function(){return this.entries||[]}}),e.constructorSetter(o,"entries"));return r.getPersonChanges=function(e,n,r){return t.get("/platform/tree/persons/"+encodeURI(e)+"/changes",n,{Accept:"application/x-gedcomx-atom+json"},r,s)},r.getChildAndParentsChanges=function(e,n,r){return t.get("/platform/tree/child-and-parents-relationships/"+encodeURI(e)+"/changes",n,{Accept:"application/x-gedcomx-atom+json"},r,s)},r.getCoupleChanges=function(e,n,r){return t.get("/platform/tree/couple-relationships/"+encodeURI(e)+"/changes",n,{Accept:"application/x-gedcomx-atom+json"},r,s)},r}),e("discussions",["helpers","plumbing"],function(e,t){var n=e.maybe,r={};r.getPersonDiscussionRefs=function(r,o,s){return t.get("/platform/tree/persons/"+encodeURI(r)+"/discussion-references",o,{Accept:"application/x-fs-v1+json"},s,e.objectExtender({getDiscussionIds:function(){return e.map(n(n(this.persons)[0])["discussion-references"],function(e){return e?e.replace(/^.*\//,"").replace(/\?.*$/,""):e})}}))};var o=r.Discussion=function(){};r.Discussion.prototype={constructor:o,getContributorId:function(){return n(this.contributor).resourceId}},r.getDiscussion=function(r,s,i){return t.get("/platform/discussions/discussions/"+encodeURI(r),s,{Accept:"application/x-fs-v1+json"},i,e.compose(e.objectExtender({getDiscussion:function(){return n(this.discussions)[0]}}),e.constructorSetter(o,"discussions")))},r.getMultiDiscussion=function(t,n,o){var s={};return e.forEach(t,function(e){s[e]=r.getDiscussion(e,n,o)}),e.promiseAll(s)};var s=r.Comment=function(){};return r.Comment.prototype={constructor:s,getContributorId:function(){return n(this.contributor).resourceId}},r.getComments=function(r,o,i){return t.get("/platform/discussions/discussions/"+encodeURI(r)+"/comments",o,{Accept:"application/x-fs-v1+json"},i,e.compose(e.objectExtender({getComments:function(){return n(n(this.discussions)[0]).comments||[]}}),e.constructorSetter(s,"comments",function(e){return n(n(e).discussions)[0]})))},r}),e("person",["helpers","plumbing"],function(e,t){var n=e.maybe,r={},o=r.Person=function(){};r.Person.prototype={constructor:o,getNames:function(){return this.names||[]},getFacts:function(){return this.facts||[]},getBirthDate:function(){return n(this.display).birthDate},getBirthPlace:function(){return n(this.display).birthPlace},getDeathDate:function(){return n(this.display).deathDate},getDeathPlace:function(){return n(this.display).deathPlace},getGender:function(){return n(this.display).gender},getLifeSpan:function(){return n(this.display).lifespan},getName:function(){return n(this.display).name},getGivenName:function(){return n(e.find(n(n(n(e.findOrFirst(this.names,{preferred:!0})).nameForms)[0]).parts,{type:"http://gedcomx.org/Given"})).value},getSurname:function(){return n(e.find(n(n(n(e.findOrFirst(this.names,{preferred:!0})).nameForms)[0]).parts,{type:"http://gedcomx.org/Surname"})).value}};var s=r.Name=function(){};r.Name.prototype={constructor:s,getContributorId:function(){return n(n(this.attribution).contributor).resourceId},getModified:function(){return n(this.attribution).modified},getNameFormsCount:function(){return this.nameForms?this.nameForms.length:0},getFullText:function(e){return n(n(this.nameForms)[e||0]).fullText},getGivenName:function(t){return n(e.find(n(n(this.nameForms)[t||0]).parts,{type:"http://gedcomx.org/Given"})).value},getSurname:function(t){return n(e.find(n(n(this.nameForms)[t||0]).parts,{type:"http://gedcomx.org/Surname"})).value}};var i=r.Fact=function(){};r.Fact.prototype={constructor:i,getContributorId:function(){return n(n(this.attribution).contributor).resourceId},getModified:function(){return n(this.attribution).modified},getDate:function(){return n(this.date).original},getFormalDate:function(){return n(this.date).formal},getPlace:function(){return n(this.place).original}},r.getPerson=function(n,o,s){return t.get("/platform/tree/persons/"+encodeURI(n),o,{},s,e.compose(e.objectExtender({getPerson:function(){return this.persons[0]}}),r.personMapper()))},r.personMapper=function(t){var n=function(n){return e.flatMap(t?t(n):[n],function(e){return e.persons})};return e.compose(e.constructorSetter(o,"persons",t),e.constructorSetter(s,"names",n),e.constructorSetter(i,"facts",n))},r.getMultiPerson=function(t,n,o){var s={};return e.forEach(t,function(e){s[e]=r.getPerson(e,n,o)}),e.promiseAll(s)};var c=r.ChildAndParents=function(){};r.ChildAndParents.prototype={constructor:c,getFatherFacts:function(){return this.fatherFacts||[]},getMotherFacts:function(){return this.motherFacts||[]},getFatherId:function(){return n(this.father).resourceId},getMotherId:function(){return n(this.mother).resourceId},getChildId:function(){return n(this.child).resourceId}};var u=r.Couple=function(){};r.Couple.prototype={constructor:u,getFacts:function(){return this.facts||[]},getMarriageFact:function(){return e.find(this.facts,{type:"http://gedcomx.org/Marriage"})},getHusbandId:function(){return n(this.person1).resourceId},getWifeId:function(){return n(this.person2).resourceId}},r.getPersonWithRelationships=function(o,s,p){return t.get("/platform/tree/persons-with-relationships",e.extend({person:o},s),{},p,e.compose(e.objectExtender({getPrimaryId:function(){return o}}),e.constructorSetter(i,"fatherFacts",function(e){return n(e).childAndParentsRelationships}),e.constructorSetter(i,"motherFacts",function(e){return n(e).childAndParentsRelationships}),e.constructorSetter(i,"facts",function(e){return n(e).relationships}),e.constructorSetter(c,"childAndParentsRelationships"),e.constructorSetter(u,"relationships"),e.objectExtender(a),r.personMapper()))};var a={getPerson:function(t){return e.find(this.persons,{id:t})},getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getParentRelationships:function(){var t=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(e){return n(e.child).resourceId===t})},getSpouseRelationships:function(){return e.filter(this.relationships,function(e){return"http://gedcomx.org/Couple"===e.type})},getSpouseRelationship:function(t){var n=this.getPrimaryId();return e.find(this.relationships,function(e){return"http://gedcomx.org/Couple"===e.type&&(n===e.getHusbandId()?e.getWifeId():e.getHusbandId())===t})},getChildRelationships:function(){var t=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(e){return n(e.father).resourceId===t||n(e.mother).resourceId===t})},getChildRelationshipsOf:function(t){var r=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(e){return!(n(e.father).resourceId!==r&&n(e.mother).resourceId!==r||n(e.father).resourceId!=t&&n(e.mother).resourceId!=t)})},getFatherIds:function(){return e.uniq(e.map(e.filter(this.getParentRelationships(),function(e){return!!e.getFatherId()}),function(e){return e.getFatherId()},this))},getFathers:function(){return e.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){return e.uniq(e.map(e.filter(this.getParentRelationships(),function(e){return!!e.getMotherId()}),function(e){return e.getMotherId()},this))},getMothers:function(){return e.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){return e.uniq(e.map(e.filter(this.getSpouseRelationships(),function(e){return e.getHusbandId()&&e.getWifeId()}),function(e){return this.getPrimaryId()===e.getHusbandId()?e.getWifeId():e.getHusbandId()},this))},getSpouses:function(){return e.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){return e.uniq(e.map(this.getChildRelationships(),function(e){return e.getChildId()},this))},getChildren:function(){return e.map(this.getChildIds(),this.getPerson,this)},getChildIdsOf:function(t){return e.uniq(e.map(this.getChildRelationshipsOf(t),function(e){return e.getChildId()},this))},getChildrenOf:function(t){return e.map(this.getChildIdsOf(t),this.getPerson,this)}};r.getPersonChangeSummary=function(n,r,o){return t.get("/platform/tree/persons/"+encodeURI(n)+"/change-summary",r,{Accept:"application/x-gedcomx-atom+json"},o,e.objectExtender({getChanges:function(){return this.entries||[]}}))},r.getRelationshipsToSpouses=function(o,s,c){return t.get("/platform/tree/persons/"+encodeURI(o)+"/spouse-relationships",s,{},c,e.compose(e.objectExtender({getPrimaryId:function(){return o}}),e.constructorSetter(u,"relationships"),e.objectExtender(p),e.constructorSetter(i,"facts",function(e){return n(e).relationships}),r.personMapper()))};var p={getRelationships:function(){return this.relationships||[]},getSpouseIds:function(){var t=this.getPrimaryId();return e.uniq(e.map(this.getRelationships(),function(e){return e.getHusbandId()===t?e.getWifeId():e.getHusbandId()},this))},getPerson:function(t){return e.find(this.persons,{id:t})}};r.getRelationshipsToParents=function(n,o,s){return t.get("/platform/tree/persons/"+encodeURI(n)+"/parent-relationships",o,{},s,e.compose(e.objectExtender(l),r.personMapper()))};var f="http://familysearch.org/v1/ChildAndParentsRelationship",l={getRelationships:function(){return e.map(e.uniq(e.map(e.filter(this.relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&!!n(e.identifiers)[f]}),function(e){return e.identifiers[f]},this)),function(t){return{id:t.replace(/^.*\//,"").replace(/\?.*$/,""),fatherId:n(n(e.find(this.relationships,function(e){return n(e.identifiers)[f]===t&&!!n(e.links).father})).person1).resourceId,motherId:n(n(e.find(this.relationships,function(e){return n(e.identifiers)[f]===t&&!!n(e.links).mother})).person1).resourceId}},this)},getPerson:function(t){return e.find(this.persons,{id:t})}},d=r.ParentChild=function(){};r.ParentChild.prototype={constructor:d,getChildAndParentsId:function(){var e=n(this.identifiers)[f];return e?e.replace(/^.*\//,"").replace(/\?.*$/,""):e},getChildId:function(){return n(this.person2).resourceId}},r.getRelationshipsToChildren=function(n,o,s){return t.get("/platform/tree/persons/"+encodeURI(n)+"/child-relationships",o,{},s,e.compose(e.objectExtender(h),e.constructorSetter(d,"relationships"),r.personMapper()))};var h={getRelationships:function(){return this.relationships||[]},getChildIds:function(){return e.uniq(e.map(this.getRelationships(),function(e){return e.getChildId()},this))},getPerson:function(t){return e.find(this.persons,{id:t})}};return r}),e("memories",["discussions","helpers","person","plumbing"],function(e,t,n,r){var o=t.maybe,s={},i=s.MemoryRef=function(){};s.MemoryRef.prototype={constructor:i,getMemoryId:function(){return this.resource?this.resource.replace(/^.*\/memories\/(\d+)\/.*$/,"$1"):this.resource}},s.getPersonMemoryRefs=function(e,n,s){return r.get("/platform/tree/persons/"+encodeURI(e)+"/memory-references",n,{},s,t.compose(t.objectExtender({getMemoryRefs:function(){return o(o(this.persons)[0]).evidence||[]}}),t.constructorSetter(i,"evidence",function(e){return o(o(e).persons)[0]})))};var c=s.Memory=function(){};return s.Memory.prototype={constructor:c,getTitle:function(){return o(o(this.titles)[0]).value},getDescription:function(){return o(o(this.description)[0]).value},getArtifactFilenames:function(){return t.map(this.artifactMetadata,function(e){return e.filename})},getIconURL:function(){return o(o(this.links)["image-icon"]).href},getThumbnailURL:function(){return o(o(this.links)["image-thumbnail"]).href},getModified:function(){return o(this.attribution).modified}},s.getPersonMemoriesQuery=function(e,n,o){return r.get("/platform/tree/persons/"+encodeURI(e)+"/memories",n,{},o,t.compose(t.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),t.constructorSetter(c,"sourceDescriptions")))},s.getUserMemoriesQuery=function(e,n,o){return r.get("/platform/memories/users/"+encodeURI(e)+"/memories",n,{},o,t.compose(t.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),t.constructorSetter(c,"sourceDescriptions")))},s.getMemory=function(e,n,s){return r.get("/platform/memories/memories/"+encodeURI(e),n,{},s,t.compose(t.objectExtender({getMemory:function(){return o(this.sourceDescriptions)[0]}}),t.constructorSetter(c,"sourceDescriptions")))},s.getMemoryComments=function(n,s,i){return r.get("/platform/memories/memories/"+encodeURI(n)+"/comments",s,{Accept:"application/x-fs-v1+json"},i,t.compose(t.objectExtender({getComments:function(){return o(o(this.discussions)[0]).comments||[]}}),t.constructorSetter(e.Comment,"comments",function(e){return o(o(e).discussions)[0]})))},s.getMemoryPersonas=function(e,o,s){return r.get("/platform/memories/memories/"+encodeURI(e)+"/personas",o,{},s,t.compose(t.objectExtender({getPersonas:function(){return this.persons||[]}}),t.constructorSetter(n.Person,"persons")))},s.getPersonPortraitURL=function(e){return t.getAPIServerUrl("/platform/tree/persons/"+encodeURI(e)+"/portrait")},s}),e("notes",["helpers","plumbing"],function(e,t){var n=e.maybe,r={},o=r.NoteRef=function(){};r.NoteRef.prototype={constructor:o},r.getPersonNoteRefs=function(r,s,i){return t.get("/platform/tree/persons/"+encodeURI(r)+"/notes",s,{},i,e.compose(e.objectExtender({getNoteRefs:function(){return n(n(this.persons)[0]).notes||[]}}),e.constructorSetter(o,"notes",function(e){return n(n(e).persons)[0]})))};var s=r.Note=function(){};return r.Note.prototype={constructor:s,getContributorId:function(){return n(n(this.attribution).contributor).resourceId},getModified:function(){return n(this.attribution).modified}},r.getPersonNote=function(r,o,i,c){return t.get("/platform/tree/persons/"+encodeURI(r)+"/notes/"+encodeURI(o),i,{},c,e.compose(e.objectExtender({getNote:function(){return n(n(n(this.persons)[0]).notes)[0]}}),e.constructorSetter(s,"notes",function(e){return n(n(e).persons)[0]})))},r.getMultiPersonNote=function(t,n,s,i){var c={};return e.forEach(n,function(e){var n=e instanceof o?e.id:e;c[n]=r.getPersonNote(t,n,s,i)}),e.promiseAll(c)},r.getCoupleNoteRefs=function(r,s,i){return t.get("/platform/tree/couple-relationships/"+encodeURI(r)+"/notes",s,{},i,e.compose(e.objectExtender({getNoteRefs:function(){return n(n(this.relationships)[0]).notes||[]}}),e.constructorSetter(o,"notes",function(e){return n(n(e).relationships)[0]})))},r.getCoupleNote=function(r,o,i,c){return t.get("/platform/tree/couple-relationships/"+encodeURI(r)+"/notes/"+encodeURI(o),i,{},c,e.compose(e.objectExtender({getNote:function(){return n(n(n(this.relationships)[0]).notes)[0]}}),e.constructorSetter(s,"notes",function(e){return n(n(e).relationships)[0]})))},r.getMultiCoupleNote=function(t,n,s,i){var c={};return e.forEach(n,function(e){var n=e instanceof o?e.id:e;c[n]=r.getCoupleNote(t,n,s,i)}),e.promiseAll(c)},r.getChildAndParentsNoteRefs=function(r,s,i){return t.get("/platform/tree/child-and-parents-relationships/"+encodeURI(r)+"/notes",s,{Accept:"application/x-fs-v1+json"},i,e.compose(e.objectExtender({getNoteRefs:function(){return n(n(this.childAndParentsRelationships)[0]).notes||[]}}),e.constructorSetter(o,"notes",function(e){return n(n(e).childAndParentsRelationships)[0]})))},r.getChildAndParentsNote=function(r,o,i,c){return t.get("/platform/tree/child-and-parents-relationships/"+encodeURI(r)+"/notes/"+encodeURI(o),i,{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender({getNote:function(){return n(n(n(this.childAndParentsRelationships)[0]).notes)[0]}}),e.constructorSetter(s,"notes",function(e){return n(n(e).childAndParentsRelationships)[0]})))},r.getMultiChildAndParentsNote=function(t,n,s,i){var c={};return e.forEach(n,function(e){var n=e instanceof o?e.id:e;c[n]=r.getChildAndParentsNote(t,n,s,i)}),e.promiseAll(c)},r}),e("parentsAndChildren",["helpers","person","plumbing"],function(e,t,n){var r=e.maybe,o={};o.getChildAndParents=function(o,i,c){return n.get("/platform/tree/child-and-parents-relationships/"+encodeURI(o),i,{Accept:"application/x-fs-v1+json"},c,e.compose(e.constructorSetter(t.ChildAndParents,"childAndParentsRelationships"),e.objectExtender(s),e.constructorSetter(t.Fact,"motherFacts",function(e){return r(e).childAndParentsRelationships}),e.constructorSetter(t.Fact,"fatherFacts",function(e){return r(e).childAndParentsRelationships}),t.personMapper()))};var s={getRelationship:function(){return r(this.childAndParentsRelationships)[0]},getPerson:function(t){return e.find(this.persons,{id:t})}};return o}),e("pedigree",["helpers","person","plumbing"],function(e,t,n){function r(t){return{getPersons:function(){return this.persons},exists:function(n){return!!s(e.find(this.persons,o(t,n))).id},getPerson:function(n){return e.find(this.persons,o(t,n))}}}function o(e,t){return function(n){return n.display[e]==t}}var s=e.maybe,i={};return i.getAncestry=function(o,i,c){return n.get("/platform/tree/ancestry",e.extend({person:o},i),{},c,e.compose(e.objectExtender(r("ascendancyNumber")),t.personMapper(),e.objectExtender({getAscendancyNumber:function(){return this.display.ascendancyNumber}},function(e){return s(e).persons})))},i.getDescendancy=function(o,i,c){return n.get("/platform/tree/descendancy",e.extend({person:o},i),{},c,e.compose(e.objectExtender(r("descendancyNumber")),t.personMapper(),e.objectExtender({getDescendancyNumber:function(){return this.display.descendancyNumber}},function(e){return s(e).persons})))},i}),e("searchAndMatch",["helpers","person","plumbing"],function(e,t,n){function r(e){return e=e.replace(/[:"]/g,"").trim(),e.indexOf(" ")>=0?'"'+e+'"':e}function o(t){return e.map(e.filter(e.keys(t),function(e){return!u[e]}),function(e){return e+":"+r(t[e])}).join(" ")}var s=e.maybe,i={},c=i.SearchResult=function(){};i.SearchResult.prototype={constructor:c,getPerson:function(t){return e.find(s(s(this.content).gedcomx).persons,{id:t})},getPrimaryPerson:function(){return this.getPerson(this.id)},getFatherIds:function(){var t=this.id,n=this;return e.uniq(e.map(e.filter(s(s(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person2.resourceId===t&&e.person1&&"http://gedcomx.org/Male"===s(n.getPerson(e.person1.resourceId).gender).type}),function(e){return e.person1.resourceId}))},getFathers:function(){return e.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){var t=this.id,n=this;return e.uniq(e.map(e.filter(s(s(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person2.resourceId===t&&e.person1&&"http://gedcomx.org/Male"!==s(n.getPerson(e.person1.resourceId).gender).type}),function(e){return e.person1.resourceId}))},getMothers:function(){return e.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){var t=this.id;return e.uniq(e.map(e.filter(s(s(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/Couple"===e.type&&(e.person1.resourceId===t||e.person2.resourceId===t)}),function(e){return e.person1.resourceId===t?e.person2.resourceId:e.person1.resourceId}))},getSpouses:function(){return e.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){var t=this.id;return e.uniq(e.map(e.filter(s(s(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person1.resourceId===t&&e.person2}),function(e){return e.person2.resourceId}))},getChildren:function(){return e.map(this.getChildIds(),this.getPerson,this)}},i.getPersonSearch=function(t,r){return n.get("/platform/tree/search",e.removeEmptyProperties({q:o(t),start:t.start,count:t.count,context:t.context}),{Accept:"application/x-gedcomx-atom+json"},r,e.compose(p,function(e,t){return e.getContext=function(){return t.getResponseHeader("X-FS-Page-Context")
},e}))};var u={start:!0,count:!0,context:!0},a={getSearchResults:function(){return this.entries||[]},getResultsCount:function(){return this.results},getIndex:function(){return this.index}},p=e.compose(e.objectExtender(a),e.constructorSetter(c,"entries"),t.personMapper(function(t){return e.map(s(t).entries,function(e){return s(e.content).gedcomx})}));return i.getPersonMatches=function(e,t,r){return n.get("/platform/tree/persons/"+encodeURI(e)+"/matches",t,{Accept:"application/x-gedcomx-atom+json"},r,p)},i.getPersonMatchesQuery=function(t,r){return n.get("/platform/tree/matches",e.removeEmptyProperties({q:o(t),start:t.start,count:t.count}),{Accept:"application/x-gedcomx-atom+json"},r,p)},i}),e("sources",["helpers","plumbing"],function(e,t){var n=e.maybe,r={},o=r.SourceRef=function(){};r.SourceRef.prototype={constructor:o,getSourceDescriptionId:function(){return this.description?this.description.replace(/.*\//,"").replace(/\?.*$/,""):this.description},getTagNames:function(){return e.map(this.tags,function(e){return e.resource})},getContributorId:function(){return n(n(this.attribution).contributor).resourceId},getModified:function(){return n(this.attribution).modified},getChangeMessage:function(){return n(this.attribution).changeMessage}},r.getPersonSourceRefs=function(r,s,i){return t.get("/platform/tree/persons/"+encodeURI(r)+"/source-references",s,{},i,e.compose(e.objectExtender({getSourceRefs:function(){return n(n(this.persons)[0]).sources||[]}}),e.constructorSetter(o,"sources",function(e){return n(n(e).persons)[0]})))};var s=r.SourceDescription=function(){};r.SourceDescription.prototype={constructor:s,getCitation:function(){return n(n(this.citations)[0]).value},getTitle:function(){return n(n(this.titles)[0]).value},getText:function(){return n(n(this.notes)[0]).text},getContributorId:function(){return n(n(this.attribution).contributor).resourceId},getModified:function(){return n(this.attribution).modified}},r.getSourceDescription=function(r,o,i){return t.get("/platform/sources/descriptions/"+encodeURI(r),o,{},i,e.compose(e.objectExtender({getSourceDescription:function(){return n(this.sourceDescriptions)[0]}}),e.constructorSetter(s,"sourceDescriptions")))},r.getMultiSourceDescription=function(t,n,s){var i={};return e.forEach(t,function(e){var t=e instanceof o?e.getSourceDescriptionId():e;i[t]=r.getSourceDescription(t,n,s)}),e.promiseAll(i)},r.getCoupleSourceRefs=function(r,s,i){return t.get("/platform/tree/couple-relationships/"+encodeURI(r)+"/source-references",s,{},i,e.compose(e.objectExtender({getSourceRefs:function(){return n(n(this.relationships)[0]).sources||[]}}),e.constructorSetter(o,"sources",function(e){return n(n(e).relationships)[0]})))},r.getChildAndParentsSourceRefs=function(r,s,i){return t.get("/platform/tree/child-and-parents-relationships/"+encodeURI(r)+"/source-references",s,{Accept:"application/x-fs-v1+json"},i,e.compose(e.objectExtender({getSourceRefs:function(){return n(n(this.childAndParentsRelationships)[0]).sources||[]}}),e.constructorSetter(o,"sources",function(e){return n(n(e).childAndParentsRelationships)[0]})))};var i=r.IdSourceRef=function(){};return r.IdSourceRef.prototype={constructor:i,getSourceRef:function(){return n(this.sources)[0]}},r.getSourceRefsQuery=function(r,s,c){return t.get("/platform/tree/source-references",e.extend({source:r},s),{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender({getPersonIdSourceRefs:function(){return this.persons||[]}}),e.constructorSetter(i,"persons"),e.objectExtender({getCoupleIdSourceRefs:function(){return this.relationships||[]}}),e.constructorSetter(i,"relationships"),e.objectExtender({getChildAndParentsIdSourceRefs:function(){return this.childAndParentsRelationships||[]}}),e.constructorSetter(i,"childAndParentsRelationships"),e.constructorSetter(o,"sources",function(t){return e.union(n(t).persons,n(t).relationships,n(t).childAndParentsRelationships)})))},r}),e("sourceBox",["helpers","plumbing","sources"],function(e,t,n){var r=e.maybe,o={},s=o.Collection=function(){};return o.Collection.prototype={constructor:s,getContributorId:function(){return r(r(this.attribution).contributor).resourceId}},o.getCollectionsForUser=function(n,r,o){return t.get("/platform/sources/"+encodeURI(n)+"/collections",{},{Accept:"application/x-fs-v1+json"},o,e.compose(e.objectExtender({getCollections:function(){return this.collections||[]}}),e.constructorSetter(s,"collections")))},o.getCollection=function(n,o,i){return t.get("/platform/sources/collections/"+encodeURI(n),o,{Accept:"application/x-fs-v1+json"},i,e.compose(e.objectExtender({getCollection:function(){return r(this.collections)[0]}}),e.constructorSetter(s,"collections")))},o.getCollectionSourceDescriptions=function(r,o,s){return t.get("/platform/sources/collections/"+encodeURI(r)+"/descriptions",o,{Accept:"application/x-fs-v1+json"},s,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),e.constructorSetter(n.SourceDescription,"sourceDescriptions")))},o.getCollectionSourceDescriptionsForUser=function(r,o,s){return t.get("/platform/sources/"+encodeURI(r)+"/collections/descriptions",o,{Accept:"application/x-fs-v1+json"},s,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),e.constructorSetter(n.SourceDescription,"sourceDescriptions")))},o}),e("spouses",["helpers","person","plumbing"],function(e,t,n){var r=e.maybe,o={};o.getCouple=function(o,i,c){return n.get("/platform/tree/couple-relationships/"+encodeURI(o),i,{},c,e.compose(e.constructorSetter(t.Couple,"relationships"),e.objectExtender(s),e.constructorSetter(t.Fact,"facts",function(e){return r(e).relationships}),t.personMapper()))};var s={getRelationship:function(){return r(this.relationships)[0]},getPerson:function(t){return e.find(this.persons,{id:t})}};return o}),e("user",["globals","helpers","plumbing"],function(e,t,n){function r(e,t){var n=null,r=t.getResponseHeader("Location");if(r||(r=t.getResponseHeader("Content-Location")),r){var o=r.match(/\/persons\/([^?]*)/);o&&(n=o[1])}n?e.resolve(n):e.reject("not found")}var o=t.maybe,s={},i=s.User=function(){};s.User.prototype={constructor:i},s.getCurrentUser=function(e,r){return n.get("/platform/users/current",e,{},r,t.compose(t.objectExtender({getUser:function(){return o(this.users)[0]}}),t.constructorSetter(i,"users")))},s.getCurrentUserPersonId=function(o,s){var i=n.get("/platform/tree/current-person",o,{},s),c=e.deferredWrapper(),u=t.extendHttpPromise(c.promise,i);return i.then(function(){r(c,i)},function(){r(c,i)}),u};var c=s.Agent=function(){};return s.Agent.prototype={constructor:c,getName:function(){return o(o(this.names)[0]).value},getAccountName:function(){return o(o(this.accounts)[0]).accountName},getEmail:function(){var e=o(o(this.emails)[0]).resource;return e?e.replace(/^mailto:/,""):e}},s.getAgent=function(e,r,s){return n.get("/platform/users/agents/"+encodeURI(e),r,{},s,t.compose(t.objectExtender({getAgent:function(){return o(this.agents)[0]}}),t.constructorSetter(c,"agents")))},s.getMultiAgent=function(e,n,r){var o={};return t.forEach(e,function(e){o[e]=s.getAgent(e,n,r)}),t.promiseAll(o)},s}),e("FamilySearch",["init","authentication","changeHistory","discussions","memories","notes","parentsAndChildren","pedigree","person","searchAndMatch","sourceBox","sources","spouses","user","plumbing"],function(e,t,n,r,o,s,i,c,u,a,p,f,l,d,h){return{init:e.init,getAuthCode:t.getAuthCode,getAccessToken:t.getAccessToken,hasAccessToken:t.hasAccessToken,invalidateAccessToken:t.invalidateAccessToken,Change:n.Change,getPersonChanges:n.getPersonChanges,getChildAndParentsChanges:n.getChildAndParentsChanges,getCoupleChanges:n.getCoupleChanges,Discussion:r.Discussion,Comment:r.Comment,getPersonDiscussionRefs:r.getPersonDiscussionRefs,getDiscussion:r.getDiscussion,getMultiDiscussion:r.getMultiDiscussion,getComments:r.getComments,Memory:o.Memory,MemoryRef:o.MemoryRef,getPersonMemoryRefs:o.getPersonMemoryRefs,getMemory:o.getMemory,getMemoryComments:o.getMemoryComments,getMemoryPersonas:o.getMemoryPersonas,getPersonPortraitURL:o.getPersonPortraitURL,getPersonMemoriesQuery:o.getPersonMemoriesQuery,getUserMemoriesQuery:o.getUserMemoriesQuery,Note:s.Note,NoteRef:s.NoteRef,getPersonNoteRefs:s.getPersonNoteRefs,getPersonNote:s.getPersonNote,getMultiPersonNote:s.getMultiPersonNote,getCoupleNoteRefs:s.getCoupleNoteRefs,getCoupleNote:s.getCoupleNote,getMultiCoupleNote:s.getMultiCoupleNote,getChildAndParentsNoteRefs:s.getChildAndParentsNoteRefs,getChildAndParentsNote:s.getChildAndParentsNote,getMultiChildAndParentsNote:s.getMultiChildAndParentsNote,getChildAndParents:i.getChildAndParents,getAncestry:c.getAncestry,getDescendancy:c.getDescendancy,Person:u.Person,Name:u.Name,Fact:u.Fact,ChildAndParents:u.ChildAndParents,Couple:u.Couple,ParentChild:u.ParentChild,getPerson:u.getPerson,getMultiPerson:u.getMultiPerson,getPersonWithRelationships:u.getPersonWithRelationships,getPersonChangeSummary:u.getPersonChangeSummary,getRelationshipsToSpouses:u.getRelationshipsToSpouses,getRelationshipsToParents:u.getRelationshipsToParents,getRelationshipsToChildren:u.getRelationshipsToChildren,SearchResult:a.SearchResult,getPersonSearch:a.getPersonSearch,getPersonMatches:a.getPersonMatches,getPersonMatchesQuery:a.getPersonMatchesQuery,Collection:p.Collection,getCollectionsForUser:p.getCollectionsForUser,getCollection:p.getCollection,getCollectionSourceDescriptions:p.getCollectionSourceDescriptions,getCollectionSourceDescriptionsForUser:p.getCollectionSourceDescriptionsForUser,SourceDescription:f.SourceDescription,SourceRef:f.SourceRef,IdSourceRef:f.IdSourceRef,getPersonSourceRefs:f.getPersonSourceRefs,getSourceDescription:f.getSourceDescription,getMultiSourceDescription:f.getMultiSourceDescription,getCoupleSourceRefs:f.getCoupleSourceRefs,getChildAndParentsSourceRefs:f.getChildAndParentsSourceRefs,getSourceRefsQuery:f.getSourceRefsQuery,getCouple:l.getCouple,Agent:d.Agent,User:d.User,getCurrentUser:d.getCurrentUser,getCurrentUserPersonId:d.getCurrentUserPersonId,getAgent:d.getAgent,getMultiAgent:d.getMultiAgent,get:h.get,post:h.post,put:h.put,del:h.del,http:h.http,getTotalProcessingTime:h.getTotalProcessingTime,setTotalProcessingTime:h.setTotalProcessingTime}}),t("FamilySearch")});